if (self.CavalryLogger) { CavalryLogger.start_js(["10A2x"]); }

__d("MStoriesStratcomEvents",[],(function(a,b,c,d,e,f){"use strict";a={DELETE_BUCKET:"fb:stories:mobile:story:viewer:story:deleted",DELETE_THREAD:"fb:stories:mobile:story:viewer:delete:thread",MUTE_BUCKET:"fb:stories:mobile:story:viewer:story:muted",MEDIA_PAUSE:"m:stories:thread:media:pause",MEDIA_PAUSE_WITH_COVER:"m:stories:thread:media:pause:with:cover",MEDIA_PLAY:"m:stories:thread:media:play",NEXT_BUCKET:"fb:stories:mobile:story:viewer:nextBucket",NEXT_CARD:"fb:stories:mobile:story:viewer:nextCard",CARD_CHANGED_BY_VIEWER_SHEET:"fb:stories:mobile:story:viewer:card:changed:by:viewer:sheet",PREV_BUCKET:"fb:stories:mobile:story:viewer:prevBucket",CLICK_STORY_IN_VIEWER_SHEET:"fb:stories:mobile:story:viewer:click:story:in:viewer:sheet",THREAD_MODAL_HIDE:"m:stories:card:modal:hide",VIDEO_PLAY:"m:video:player:play",VIDEO_PLAYING:"m:video:player:playing",VIEWER_SHEET_HIDE:"m-stories-viewer-sheet-hide",VIEWER_SHEET_HIDDEN:"m-stories-viewer-sheet-hidden",VIEWER_SHEET_OPEN:"m-stories-viewer-sheet-open",VIEWER_SHEET_IMAGE_CHANGED_BY_SCROLLING:"m-stories-viewer-sheet-image-changed-by-scrolling",VIEWER_SHEET_NATIVE_TEMPLATE_CHANGED_BY_SCROLLING:"m-stories-viewer-sheet-native-template-changed-by-scrolling",PRODUCTION_PREVIEW_CONTROLS_HIDE:"m:stories:production:preview-controls:hide",PRODUCTION_PREVIEW_CONTROLS_SHOW:"m:stories:production:preview-controls:show",PRODUCTION_TEXT_CONTROLS_HIDE:"m:stories:production:text-controls:hide",PRODUCTION_TEXT_CONTROLS_SHOW:"m:stories:production:text-controls:show",PRODUCTION_TEXT_OVERLAY_REMOVE:"m:stories:production:text-overlay:remove",PRODUCTION_TEXT_OVERLAY_FOCUS:"m:stories:production:text-overlay:focus",SWIPE_LEFT:"m:stories:swipe:left",SWIPE_RIGHT:"m:stories:swipe:right",SWIPE_DOWN:"m:stories:swipe:down",SWIPE_UP:"m:stories:swipe:up",SWIPE_REPLY:"fb:stories:mobile:story:viewer:swipe:reply",TOAST_SHOWING:"m:stories:toast:showing",TOAST_HIDING:"m:stories:toast:hiding",UPLOAD_FAILED:"m:stories:upload:failed",UPLOAD_SUCCESS:"m:stories:upload:success",OVERLAY_INTERACTION_PAUSE:"m:stories:overlay-interaction:pause",OVERLAY_INTERACTION_PLAY:"m:stories:overlay-interaction:play",SET_BUCKET_IDS_USE_FOR_TESTING_ONLY:"m:stories:set-bucket-ids-use-for-testing-only"};e.exports=a}),null);
__d("MStoriesDOMUtils",["Bootloader","DOM"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={find:function(a,c,d){a=b("DOM").scry(a,c,d);if(a.length===0){b("Bootloader").loadModules(["FBLogger"],function(a){a("fbstories").mustfix("Failed to load dom element with tag %s and sigil %s",c,d||"")},"MStoriesDOMUtils");return null}return a[0]}};e.exports=a}),null);
__d("MStoriesGating",["MFBStoriesGatingConfig","gkx","qex"],(function(a,b,c,d,e,f){"use strict";a={genShouldShowTextOverlays:function(){return b("MFBStoriesGatingConfig").enableTextOverlayProduction},genShouldShowStoriesEffects:function(){return b("gkx")("676799")},shouldShowOptimisticPreviews:function(){return b("gkx")("676800")},shouldShowNTViewerSheet:function(){return b("qex")._("863251")}};e.exports=a}),null);
__d("MStoriesHideHeaderListener",["Bootloader","MArrays","MStoriesUIConstants","Stratcom","URI"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g,h="m:page:render:start";a={_hideHeaderListener:null,setup:function(){var a=this;if(this._hideHeaderListener)return;this._hideHeaderListener=b("Stratcom").listen(h,null,function(c){c=new(g||(g=b("URI")))(c.getData().path);c=c.getPath();b("MArrays").findPrefix(b("MStoriesUIConstants").HIDE_HEADER_URLS,c)&&(b("Bootloader").loadModules(["MStoriesDisplayUtils"],function(a){a.toggleChromeBar(!1)},"MStoriesHideHeaderListener"),b("Stratcom").removeCurrentListener(),a._hideHeaderListener=null)})}};e.exports=a}),null);
__d("MStoriesProductionInfo",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={_uploadStatus:null,_uri:null,_rotate:0,setUploadStatus:function(a){this._uploadStatus=a},getUploadStatus:function(){return this._uploadStatus},setChosenImage:function(a){var b=a.URI;a=a.rotate;this._uri=b;this._rotate=a},getChosenImage:function(){return{URI:this._uri,rotate:this._rotate}}};e.exports=a}),null);
__d("MStoriesUploadStatus",[],(function(a,b,c,d,e,f){"use strict";e.exports=Object.freeze({IDLE:0,UPLOADING:1,FAILED:2})}),null);
__d("MStoriesProductionTrayUtils",["cx","CSS","MFBStoriesGatingConfig","MStoriesDOMUtils","MStoriesProductionInfo","MStoriesUploadStatus"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h={getAnimationPog:function(){var a=document.getElementById("m-stories-owner-bucket-pog");return a?a:document.getElementById("m-stories-add-item-pog")},getUploadingClass:function(){var a=b("MFBStoriesGatingConfig").trayType;return a==="nine_by_sixteen"?"loading":"_1zpf"},updateProductionPog:function(){__p&&__p();var a=b("MStoriesProductionInfo").getUploadStatus();if(a===b("MStoriesUploadStatus").UPLOADING){var c=h.getAnimationPog(),d=document.getElementById("m-stories-add-item-pog"),e=document.getElementById("m-stories-add-item"),f=document.getElementById("m-stories-owner-bucket-pog"),g=h.getUploadingClass();c&&(b("CSS").addClass(c,g),c.id==="m-stories-owner-bucket-pog"?(d&&b("CSS").removeClass(d,g),e&&b("CSS").addClass(e,"disable")):(f&&b("CSS").removeClass(f,g),e&&b("CSS").removeClass(e,"disable")))}c=b("MFBStoriesGatingConfig").trayType;if(c!=="circular"){d=document.getElementById("m-stories-owner-bucket");if(d){f=d.getAttribute("data-is-optimistic-item")!=null;g=a===b("MStoriesUploadStatus").UPLOADING||a===b("MStoriesUploadStatus").FAILED;f&&(g?b("CSS").removeClass(d,"hidden"):b("CSS").addClass(d,"hidden"))}this._updateProductionItemText()}this._updateErrorState()},_updateProductionItemText:function(){__p&&__p();var a=document.getElementById("m-stories-owner-bucket");if(!a)return;var c=b("MStoriesDOMUtils").find(a,"div","m-stories-rectangular-item-title");a=b("MStoriesDOMUtils").find(a,"div","m-stories-rectangular-item-adding-story-title");if(c&&a){var d=b("MStoriesProductionInfo").getUploadStatus();switch(d){case b("MStoriesUploadStatus").UPLOADING:b("CSS").addClass(c,"hidden");b("CSS").removeClass(a,"hidden");break;default:b("CSS").addClass(a,"hidden");b("CSS").removeClass(c,"hidden");break}}},_updateErrorState:function(){__p&&__p();var a=b("MStoriesProductionInfo").getUploadStatus(),c=b("MFBStoriesGatingConfig").trayType;switch(c){case"fblite_with_profile_pog":c=document.getElementById("m-stories-owner-bucket");if(c!=null){var d=b("MStoriesDOMUtils").find(c,"div","m-stories-rectangular-item-count");c=b("MStoriesDOMUtils").find(c,"div","m-stories-rectangular-item-count-error");d&&c&&(a===b("MStoriesUploadStatus").FAILED?(b("CSS").addClass(d,"hiddenByError"),b("CSS").removeClass(c,"hidden")):(b("CSS").removeClass(d,"hiddenByError"),b("CSS").addClass(c,"hidden")))}break;case"mobile_three_by_one":d=this.getAnimationPog();a===b("MStoriesUploadStatus").FAILED?b("CSS").addClass(d,"_6y1s"):b("CSS").removeClass(d,"_6y1s");break;case"nine_by_sixteen":c=this.getAnimationPog();d=document.getElementById("m-stories-owner-title");a===b("MStoriesUploadStatus").FAILED?(b("CSS").addClass(c,"error"),d&&b("CSS").addClass(d,"error")):(b("CSS").removeClass(c,"error"),d&&b("CSS").removeClass(d,"error"));break;default:c=this.getAnimationPog();c&&(a===b("MStoriesUploadStatus").FAILED?b("CSS").addClass(c,"_4ts1"):b("CSS").removeClass(c,"_4ts1"));break}}};e.exports=h}),null);
__d("MStoriesTrayInfo",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={_hasNextPage:{},_trayBucketIDs:{},_trayTrackingStrings:{},_trayNeedsRefresh:!1,setTrayBucketIDs:function(a){var b=this._getKey(a.key);this._trayBucketIDs[b]=a.bucketIDs;this._hasNextPage[b]=a.hasNextPage;this._trayTrackingStrings[b]=a.trackingStrings},appendTrayBucketIDs:function(a){var b=this._getKey(a.key);this._trayBucketIDs[b]==null&&(this._trayBucketIDs[b]=[]);this._trayBucketIDs[b]=this._trayBucketIDs[b].concat(a.bucketIDs);this._trayTrackingStrings[b]==null&&(this._trayTrackingStrings[b]=[]);this._trayTrackingStrings[b]=this._trayTrackingStrings[b].concat(a.trackingStrings);this._hasNextPage[b]=a.hasNextPage},getTrayBucketIDs:function(a){a=this._getKey(a);return this._trayBucketIDs[a]},getTrayTrackingStrings:function(a){a=this._getKey(a);return this._trayTrackingStrings[a]||[]},getHasNextPage:function(a){a=this._getKey(a);return!!this._hasNextPage[a]},_getKey:function(a){return a==null?"top_of_feed":a},setTrayNeedsRefresh:function(a){this._trayNeedsRefresh=a},getTrayNeedsRefresh:function(){return this._trayNeedsRefresh}};e.exports=a}),null);
__d("MStoriesTrayUIConstants",[],(function(a,b,c,d,e,f){"use strict";a={REDIRECT_DELAY_IN_MS:20};e.exports=a}),null);
__d("MStoriesTrayAsync",["cx","requireCond","Bootloader","CSS","DOM","MFBStoriesGatingConfig","MFBStoriesOptimisticTrayGatedModule","MPageController","MStoriesDOMUtils","MStoriesGating","MStoriesHideHeaderListener","MStoriesProductionTrayUtils","MStoriesStratcomEvents","cr:710451","MStoriesTrayInfo","MStoriesTrayUIConstants","QuickPerformanceLogger","Run","Stratcom","URI","WebFunnelLogger"],(function(a,b,c,d,e,f,g){__p&&__p();var h,i=b("MFBStoriesOptimisticTrayGatedModule").module,j="m:page:render:cache:complete-with-replays";a={_currentItemLoading:null,_listeners:[],_spinner:null,_feedUnitURIs:[],registerFeedUnitWithUri:function(a){this._feedUnitURIs.push(a.uri)},updateSpinner:function(a){__p&&__p();var c=this;this._spinner=a.spinner;if(this._listeners.length===0){this._listeners=[(a=b("Stratcom")).listen(j,null,function(){if(!b("MStoriesTrayInfo").getTrayNeedsRefresh())return;b("Bootloader").loadModules(["MStoriesTrayUtils"],function(a){a.refreshTray(),a.refreshFeedUnitsWithURIs(c._feedUnitURIs)},"MStoriesTrayAsync")}),a.listen("click","m-stories-tray-archive-link",this._openArchive),a.listen("click","m-stories-tray-pog-container",function(a){c._openPOG(a)}),a.listen("keypress","m-stories-tray-pog-container",function(a){var b=a.getSpecialKey();(b==="return"||b==="space")&&(a.prevent(),c._openPOG(a))}),a.listen(b("MStoriesStratcomEvents").UPLOAD_SUCCESS,null,function(a){a=a.getData()||{};i&&i.handleUploadSuccess(a.newThreadID,a.optimisticThreadID)})]}b("MStoriesHideHeaderListener").setup();i&&i.initializeOnTrayLoad();b("MStoriesProductionTrayUtils").updateProductionPog();b("Run").onLeave(function(){c._destroy()})},_openArchive:function(a){a=a.getNode("m-stories-tray-archive-link");if(a!=null){var c=a.getAttribute("data-href");c&&window.setTimeout(function(){b("MPageController").load(c,{hideLoadingIndicator:!1})})}},_openPOG:function(a){__p&&__p();var c=this,d=a.getNode("m-stories-tray-pog-container");if(this._currentItemLoading){if(this._currentItemLoading===d)return;this._setLoadingStateHidden(this._currentItemLoading,!0)}if(!d)return;d.id==="m-stories-owner-bucket"?b("Bootloader").loadModules(["MStoriesProductionTrayAsync"],function(a){if(!d)return;if(a.handleFailedAddToStoryPogSelected())return;c._openViewer(d)},"MStoriesTrayAsync"):this._openViewer(d)},_setLoadingStateHidden:function(a,c){__p&&__p();var d=b("MFBStoriesGatingConfig").trayType,e=c?b("CSS").removeClass:b("CSS").addClass;switch(d){case"circular":e(a,"loading");break;case"fblite_with_profile_pog":e(a,"_6pvo");break;case"nine_by_sixteen":case"mobile_three_by_one":a=b("MStoriesDOMUtils").find(a,"div","m-stories-tray-pog");if(a){if(c&&a.id==="m-stories-owner-bucket-pog")return;d==="nine_by_sixteen"?e(a,"loading"):e(a,"_1zpf")}break}},_openViewer:function(a){__p&&__p();this._currentItemLoading=a;var c=b("MFBStoriesGatingConfig").trayType;c=c!=="circular";b("QuickPerformanceLogger").markerEnd(13238313,4);b("QuickPerformanceLogger").markerStart(13238313);if(!c){c=b("MStoriesDOMUtils").find(a,"i","m-stories-tray-pog-picture");c!==null&&b("DOM").insertAfter(c,this._spinner)}var d=a.getAttribute("data-href");b("MStoriesGating").shouldShowOptimisticPreviews()&&a.id==="m-stories-owner-bucket"&&i&&(d=i.getURI(a));if(d){c=new(h||(h=b("URI")))(d);c=c.getQueryData();var e=c.tray_session_id;new(b("WebFunnelLogger"))("FBStoriesMTouchTrayViewerFunnelDefinition").addFunnelPayload("tray_index",c.selected_bucket_index).setSessionKey((c=e)!=null?c:"null").setAction("Tray item select").log();this._setLoadingStateHidden(a,!1);window.setTimeout(function(){b("MPageController").load(d,{hideLoadingIndicator:!0});var a=b("Stratcom").listen("m:page:iui:response:complete",null,function(c){c=c.getData()||{};c=c.path;if(c==null||!c.includes("stories/view_tray"))return;new(b("WebFunnelLogger"))("FBStoriesMTouchTrayViewerFunnelDefinition").setSessionKey((c=e)!=null?c:"null").setAction("Viewer rendered").markEnd().log();a.remove()})},b("MStoriesTrayUIConstants").REDIRECT_DELAY_IN_MS)}},_destroy:function(){var a=b("MStoriesProductionTrayUtils").getAnimationPog();a&&b("CSS").removeClass(a,b("MStoriesProductionTrayUtils").getUploadingClass());this._listeners.forEach(function(a){return a.remove()});this._listeners=[]}};e.exports=a}),null);
__d("MStoriesUtils",["cx","fbt","DOM","MPageController","MStoriesStratcomEvents","MStoriesUIConstants","Stratcom","Style","gkx","goURI"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i={UNSET:"UNSET",PUBLIC:"PUBLIC",FRIENDS_AND_CONNECTIONS:"FRIENDS_AND_CONNECTIONS",FRIENDS:"FRIENDS",CUSTOM:"CUSTOM"},j=[],k={getDocumentScale:function(){var a=window.visualViewport;return a?a.scale:document.body?document.body.clientWidth/window.innerWidth:1},listenForThreadTransition:function(a){var c,d;c=[(c=b("Stratcom")).listen("click","m-stories-next-button",a),c.listen("click","m-stories-prev-button",a),c.listen((d=b("MStoriesStratcomEvents")).CARD_CHANGED_BY_VIEWER_SHEET,null,a),c.listen(d.NEXT_CARD,null,a),c.listen(d.NEXT_BUCKET,null,a),c.listen(d.PREV_BUCKET,null,a)];return c},iOSVersion:function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var a=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return a==null?null:parseInt(a[1],10)}return null},goBackToHomepage:function(){if(j.length>0){b("MPageController").load(j.pop(),{expiration:b("MStoriesUIConstants").REFRESH_TIMEOUT_IN_MS});return}var a=document.getElementsByClassName("_129-")[0],c=this.iOSVersion();c=c&&c<10;!c&&(a||b("gkx")("709647"))?(b("DOM").show(a),b("MPageController").load("/",{expiration:b("MStoriesUIConstants").REFRESH_TIMEOUT_IN_MS})):b("goURI")("/")},getCropInfo:function(a,b,c,d,e){__p&&__p();var f={sx:0,sy:0,sWidth:a,sHeight:b,dWidth:c,dHeight:d};if(!e){e=a/b;e=c/e;e<=d?f.dHeight=e:(f.sy=(e-d)/2*(b/e),f.sHeight=b-f.sy*2)}else{e=c/b*a;e<=d?f.dHeight=e:(f.sx=(e-d)/2*(a/d),f.sWidth=a-f.sx*2)}return f},getAudienceModeHeaderMapping:function(a){switch(a){case i.PUBLIC:return h._("Public");case i.FRIENDS_AND_CONNECTIONS:return h._("Friends and connections");case i.FRIENDS:return h._("Friends");case i.CUSTOM:return h._("Custom");default:return h._("Unset")}},touchMoveListener:function(a){a.touches.length===1&&k.getDocumentScale()===1&&a.preventDefault()},truncateParagraphToFitContainer:function(a){__p&&__p();var c=a.textContent,d=!1;do{var e=b("Style").get(a,"max-height");b("Style").set(a,"max-height","unset");var f=a.clientHeight;b("Style").set(a,"maxHeight",e);e=a.clientHeight;if(f<=e){d=!0;break}c=c.slice(0,-1);a.textContent=c+"..."}while(!d)},setExitUri:function(a,b){b===void 0&&(b=!1);if(a==null)return;b?j.push(a):j=[a]},getInnerText:function(a){var b="",c=!0;for(var d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];e.nodeType===Node.TEXT_NODE?(b+=e.textContent,c=!1):e.nodeName.toLowerCase()==="br"&&!c?(b+="\n",c=!0):e.nodeName.toLowerCase()!=="br"&&(c||(b+="\n"),b+=e.textContent,b+="\n",c=!0)}return b},isIOS:function(){if(!navigator.userAgent)return!1;return navigator.userAgent.match(/iPhone/)||navigator.userAgent.match(/iPod/)||navigator.userAgent.match(/iPad/)?!0:!1}};e.exports=k}),null);