if (self.CavalryLogger) { CavalryLogger.start_js(["pXZ3z"]); }

__d("IrisProtocolMessageLifetime",[],(function(a,b,c,d,e,f){e.exports={TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:3e4,TTL_1MINUTE:6e4,TTL_3MINUTES:18e4,TTL_5MINUTES:3e5,TTL_10MINUTES:6e5,TTL_15MINUTES:9e5,TTL_30MINUTES:18e5,TTL_1HOUR:36e5,TTL_2HOURS:72e5,TTL_4HOURS:144e5,TTL_8HOURS:288e5,TTL_12HOURS:432e5,TTL_24HOURS:864e5}}),null);
__d("MercuryAudioType",[],(function(a,b,c,d,e,f){e.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"}}),null);
__d("MessagingTag",[],(function(a,b,c,d,e,f){e.exports={GROUPS:"groups",UNREAD:"unread",FLAGGED:"flagged",ACTION_ARCHIVED:"action:archived",INBOX:"inbox",MARKETPLACE_FOLDER:"marketplace_folder",OTHER:"other",PENDING:"pending",MONTAGE:"montage",PAGES:"pages",PAGE_BACKGROUND:"page_background",ACTION_COPIED_MESSAGE:"action:copy_message",ACTION_COPIED_SELF_MESSAGE:"copy_self_message",ACTION_COPIED_ATTACHMENT:"action:copy_attachment",ACTION_COPIED_SELF_ATTACHMENT:"copy_self_attachment",EVENT:"event",SENT:"sent",SPAM:"spam",UPDATES:"broadcasts_inbox",BCC:"header:bcc",FILTERED_CONTENT:"filtered_content",FILTERED_CONTENT_BH:"filtered_content_bh",FILTERED_CONTENT_ACCOUNT:"filtered_content_account",FILTERED_CONTENT_QUASAR:"filtered_content_quasar",FILTERED_CONTENT_INVALID_APP:"filtered_content_invalid_app",ONE_WAY_MESSAGE:"one_way_message",UNAVAILABLE_ATTACHMENT:"unavailable_attachment",ARCHIVED:"archived",EMAIL:"email",VOICEMAIL:"voicemail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SMS_TAG_ROOT:"SMSShortcode:",APP_ID_ROOT:"app_id:",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",MTA_SYSTEM_MESSAGE:"MTA:system_message",EMAIL_MESSAGE:"source:email",ONE_CLICK_MESSAGE:"page_one_click_message",MARKETPLACE:"marketplace",ROOM:"room",PAGE_FOLLOWUP:"page_followup",MESSAGE_REQUEST_AGGREGATION_UNIT:"message_request_aggregation_unit",IRIS_MAPPING:{FOLDER_INVALID:null,FOLDER_INBOX:"inbox",FOLDER_OTHER:"other",FOLDER_SPAM:"spam",FOLDER_PENDING:"pending",FOLDER_MONTAGE:"montage",FOLDER_HIDDEN:"hidden",FOLDER_DISABLED:"disabled",FOLDER_PAGE_BACKGROUND:"page_background",FOLDER_PAGE_DONE:"page_done",FOLDER_BLOCKED:"blocked"}}}),null);
__d("MercuryAttachmentSnippetType",["keyMirror"],(function(a,b,c,d,e,f){a=b("keyMirror")({PHOTO:null,GIF:null,VIDEO:null,AUDIO_CLIP:null,STICKER:null,SHARE:null,ERROR:null,MIXED:null,GIFT:null,THIRDPARTYSTICKER:null,FILE:null,LIKE_STICKER:null});e.exports=a}),null);
__d("MercuryGiftSnippetRenderer",["fbt"],(function(a,b,c,d,e,f,g){"use strict";a={renderText:function(a,b){return a?g._("You sent a Valentine."):g._("{name} sent a Valentine.",[g._param("name",b)])}};e.exports=a}),null);
__d("MessengerLightweightActionUtils",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a){return!!(a&&a.attach_type==="share"&&a.share&&a.share.target&&a.share.target.lwa_type)}function a(a){a=a==null?void 0:a.attachments;return!!(a&&a.length===1&&g(a[0]))}function b(a){return a.attachments[0].share.title}function c(a){return a[0].share.title}e.exports={isLWAMessage:a,isLWAAttachment:g,getCollapsedLWAText:b,getLWASnippetText:c}}),null);
__d("P2PSnippetStringUtils",["fbt"],(function(a,b,c,d,e,f,g){__p&&__p();a={getRequestCanceledSnippet:function(a,b,c,d,e){if(a)return g._("Your request for {payment request amount} from {receiver's name} was cancelled.",[g._param("payment request amount",e),g._param("receiver's name",d)]);else if(b)return g._("{requester's name}'s request for {payment request amount} was cancelled.",[g._param("requester's name",c),g._param("payment request amount",e)]);else return g._("{requester's name}'s request for {payment request amount} from {receiver's name} was cancelled.",[g._param("requester's name",c),g._param("payment request amount",e),g._param("receiver's name",d)])},getRequestDeclinedSnippet:function(a,b,c,d,e){if(a)return g._("{receiver's name} declined your request for {payment request amount}.",[g._param("receiver's name",d),g._param("payment request amount",e)]);else if(b)return g._("You declined {requester's name}'s request for {payment request amount}.",[g._param("requester's name",c),g._param("payment request amount",e)]);else return g._("{receiver's name} declined {sender's name}'s request for {payment request amount}.",[g._param("receiver's name",d),g._param("sender's name",c),g._param("payment request amount",e)])},getRequestSentSnippet:function(a,b,c,d,e){if(a)return g._("You requested {amount} from {requestee name}.",[g._param("amount",e),g._param("requestee name",d)]);else if(b)return g._("{requester name} requested {amount} from you.",[g._param("requester name",c),g._param("amount",e)]);else return g._("{name} requested {amount} from {requestee name}.",[g._param("name",c),g._param("amount",e),g._param("requestee name",d)])},getRequestSnippetByStatus:function(a,b,c,d,e,f){a=a||1;b=[b,c,d,e,f];switch(a){case 2:return this.getRequestDeclinedSnippet.apply(this,b);case 5:case 6:return this.getRequestCanceledSnippet.apply(this,b)}return this.getRequestSentSnippet.apply(this,b)},getTransferCanceledSnippet:function(a,b,c,d,e){if(a)return g._("Your payment of {amount} to {receiver_name} was cancelled.",[g._param("amount",e),g._param("receiver_name",d)]);else if(b)return g._("{sender name}'s payment of {amount} was cancelled.",[g._param("sender name",c),g._param("amount",e)]);else return g._("{sender_name}'s payment of {amount} to {receiver_name} was cancelled.",[g._param("sender_name",c),g._param("amount",e),g._param("receiver_name",d)])},getTransferDeclinedSnippet:function(a,b,c,d,e){if(a)return g._("{receiver_name} didn't accept your payment of {amount}.",[g._param("receiver_name",d),g._param("amount",e)]);else if(b)return g._("You didn't accept {sender name}'s payment of {amount}.",[g._param("sender name",c),g._param("amount",e)]);else return g._("{receiver_name} didn't accept {sender_name}'s payment of {amount}.",[g._param("receiver_name",d),g._param("sender_name",c),g._param("amount",e)])},getTransferSentSnippet:function(a,b,c,d,e){if(a)return g._("You sent {amount} to {receiver name}.",[g._param("receiver name",d),g._param("amount",e)]);else if(b)return g._("{name} sent {amount} to you.",[g._param("name",c),g._param("amount",e)]);else return g._("{sender name} sent {amount} to {receiver name}.",[g._param("sender name",c),g._param("receiver name",d),g._param("amount",e)])},getTransferSnippetByStatus:function(a,b,c,d,e,f){b=[b,c,d,e,f];c=a||15;switch(c){case 5:return this.getTransferDeclinedSnippet.apply(this,b);case 3:case 10:case 11:case 12:case 16:return this.getTransferCanceledSnippet.apply(this,b)}return this.getTransferSentSnippet.apply(this,b)}};e.exports=a}),null);
__d("MercuryAttachmentSnippetRenderer",["fbt","CurrentUser","MercuryAttachmentSnippetType","MercuryAudioType","MercuryGiftSnippetRenderer","MessengerLightweightActionUtils","P2PSnippetStringUtils","StickerConstants","gkx"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a={getAttachmentSnippetType:function(a){__p&&__p();if(this._hasOnlyPhotos(a))return b("MercuryAttachmentSnippetType").PHOTO;if(this._hasOnlyAnimatedImages(a))return b("MercuryAttachmentSnippetType").GIF;if(this._hasOnlyVideo(a))return b("MercuryAttachmentSnippetType").VIDEO;if(this._hasAudioClip(a))return b("MercuryAttachmentSnippetType").AUDIO_CLIP;if(this._hasLikeSticker(a))return b("MercuryAttachmentSnippetType").LIKE_STICKER;if(this._hasSticker(a))return b("MercuryAttachmentSnippetType").STICKER;if(this._hasThirdPartySticker(a))return b("MercuryAttachmentSnippetType").THIRDPARTYSTICKER;if(this._hasShare(a))return b("MercuryAttachmentSnippetType").SHARE;if(this._hasGift(a))return b("MercuryAttachmentSnippetType").GIFT;if(this._hasError(a))return b("MercuryAttachmentSnippetType").ERROR;return this._hasFile(a)?b("MercuryAttachmentSnippetType").FILE:b("MercuryAttachmentSnippetType").MIXED},renderAttachmentSnippetText:function(a,c,d,e){__p&&__p();switch(a){case b("MercuryAttachmentSnippetType").PHOTO:return this._renderPhotoAttachmentSnippetText(c,d,this._getPhotoAttachments(e));case b("MercuryAttachmentSnippetType").GIF:return this._renderAnimatedImagesAttachmentSnippetText(c,d,this._getAnimatedImageAttachments(e));case b("MercuryAttachmentSnippetType").VIDEO:return c?g._("You sent a video."):g._("{sender name} sent a video.",[g._param("sender name",d)]);case b("MercuryAttachmentSnippetType").AUDIO_CLIP:return c?g._("You sent a voice message."):g._("{name} sent a voice message.",[g._param("name",d)]);case b("MercuryAttachmentSnippetType").STICKER:case b("MercuryAttachmentSnippetType").LIKE_STICKER:case b("MercuryAttachmentSnippetType").THIRDPARTYSTICKER:return c?g._("You sent a sticker."):g._("{name} sent a sticker.",[g._param("name",d)]);case b("MercuryAttachmentSnippetType").SHARE:if(e&&this._hasP2PPayment(e))return this._renderP2PPaymentSnippetText(e[0]);if(e&&this._hasP2PPaymentRequest(e))return this._renderP2PPaymentRequestSnippetText(e[0]);if(e&&this._hasBusinessMessage(e))return this._renderBusinessMessageSnippetText(e[0],d);if(e&&this._hasLocation(e))return c?g._("You sent a location."):g._("{sender name} sent a location.",[g._param("sender name",d)]);if(e&&this._hasLiveLocation(e))return c?g._("You sent a live location."):g._("{sender name} sent a live location.",[g._param("sender name",d)]);if(e&&this._hasMontageDirect(e)){if(!b("gkx")("676919"))return c?g._("You sent a link."):g._("{sender name} sent a link.",[g._param("sender name",d)]);a=e[0];a=(a=a)!=null?(a=a.share)!=null?(a=a.media)!=null?a.source:a:a:a;return c?a?g._("You sent a video."):g._("You sent a photo."):a?g._("View {sender name}'s disappearing video.",[g._param("sender name",d)]):g._("View {sender name}'s disappearing photo.",[g._param("sender name",d)])}if(e&&e.length===1&&b("MessengerLightweightActionUtils").isLWAAttachment(e[0]))return b("MessengerLightweightActionUtils").getLWASnippetText(e);return e&&e.length===1&&this._isGloballyRemovedMessageAttachment(e[0])?e[0].share.description:c?g._("You sent a link."):g._("{sender name} sent a link.",[g._param("sender name",d)]);case b("MercuryAttachmentSnippetType").GIFT:return b("MercuryGiftSnippetRenderer").renderText(c,d);case b("MercuryAttachmentSnippetType").FILE:return c?g._("You sent an attachment."):g._("{sender name} sent an attachment.",[g._param("sender name",d)]);case b("MercuryAttachmentSnippetType").ERROR:return c?g._("You sent an attachment."):g._("{sender name} sent an attachment.",[g._param("sender name",d)]);default:return""}},_isGloballyRemovedMessageAttachment:function(a){return a.share&&a.share.style_list&&a.share.style_list.includes("globally_deleted_message_placeholder")},_hasOnlyPhotos:function(a){return this._getPhotoAttachments(a).length===a.length},_hasThirdPartySticker:function(a){return a.length===1&&a[0].attach_type==="third_party_sticker"},_hasOnlyAnimatedImages:function(a){return this._getAnimatedImageAttachments(a).length===a.length},_hasOnlyVideo:function(a){return a.length===1&&a[0].attach_type==="video"},_hasAudioClip:function(a){var c=a[0].metadata&&a[0].metadata.type;return a.length===1&&(c===b("MercuryAudioType").AudioClip||c===b("MercuryAudioType").VoiceMessageWithTranscript)},_hasBusinessMessage:function(a){return this._hasSingleShareAttachmentOfStyle(a,"business_message_items")},_hasSticker:function(a){return a.length===1&&a[0].attach_type==="sticker"},_hasLikeSticker:function(a){if(a.length<1)return!1;var c=a[0].metadata&&a[0].metadata.stickerID;return a.length===1&&(c==b("StickerConstants").LIKE_STICKER_ID||c==b("StickerConstants").HOT_LIKE_SMALL_STICKER_ID||c==b("StickerConstants").HOT_LIKE_MEDIUM_STICKER_ID||c==b("StickerConstants").HOT_LIKE_LARGE_STICKER_ID)},_hasLocation:function(a){return this._hasSingleShareAttachmentOfStyle(a,"message_location")},_hasLiveLocation:function(a){return this._hasSingleShareAttachmentOfStyle(a,"message_live_location")},_hasMontageDirect:function(a){return this._hasSingleShareAttachmentOfStyle(a,"montage_direct")},_hasP2PPayment:function(a){return this._hasSingleShareAttachmentOfStyle(a,"orion")},_hasP2PPaymentRequest:function(a){return this._hasSingleShareAttachmentOfStyle(a,"orion_request")},_hasSingleShareAttachmentOfStyle:function(a,b){return a.length===1&&a[0].attach_type==="share"&&a[0].share.style_list.indexOf(b)>=0},_hasShare:function(a){return a.length===1&&a[0].attach_type==="share"},_hasError:function(a){return a.length===1&&a[0].attach_type==="error"},_hasGift:function(a){return a.length===1&&a[0].attach_type==="gift"},_hasFile:function(a){return a.length===1&&a[0].attach_type==="file"},_getPhotoAttachments:function(a){return!a?[]:a.filter(function(a){return a.attach_type==="photo"})},_getAnimatedImageAttachments:function(a){return!a?[]:a.filter(function(a){return a.attach_type==="animated_image"})},_renderPhotoAttachmentSnippetText:function(a,b,c){if(c.length===1)if(a)return g._("You sent a photo.");else return g._("{name} sent a photo.",[g._param("name",b)]);else if(a)return g._({"*":"You sent {num_photos} photos."},[g._param("num_photos",c.length,[0])]);else return g._({"*":"{name} sent {num_photos} photos."},[g._param("name",b),g._param("num_photos",c.length,[0])])},_renderAnimatedImagesAttachmentSnippetText:function(a,b,c){if(c.length===1)if(a)return g._("You sent a GIF.");else return g._("{name} sent a GIF.",[g._param("name",b)]);else if(a)return g._("You sent {num_animated_images} GIFs.",[g._param("num_animated_images",c.length)]);else return g._("{name} sent {num_animated_images} GIFs.",[g._param("name",b),g._param("num_animated_images",c.length)])},_renderBusinessMessageSnippetText:function(a,b){a=a.share.target;a=a&&a.message||g._("{sender name} sent an attachment.",[g._param("sender name",b)]);return a},_renderP2PPaymentSnippetText:function(a){a=a.share.target;return this.renderP2PPaymentSnippetText(b("CurrentUser").getID()===a.sender.id,a.sender.name,a.amountWithSymbol,a.status,b("CurrentUser").getID()===a.receiver.id,a.receiver.name)},_renderP2PPaymentRequestSnippetText:function(a){a=a.share.target;return this.renderP2PPaymentRequestSnippetText(b("CurrentUser").getID()===a.requester.id,a.requester.name,a.amountWithSymbol,a.currentStatus,b("CurrentUser").getID()===a.requestee.id,a.requestee.name)},renderP2PPaymentSnippetText:function(a,c,d,e,f,g){return b("P2PSnippetStringUtils").getTransferSnippetByStatus(e,a,f||!1,c||"",g||"",d)},renderP2PPaymentRequestSnippetText:function(a,c,d,e,f,g){return b("P2PSnippetStringUtils").getRequestSnippetByStatus(e,a,f||!1,c||"",g||"",d)}};e.exports=a}),null);
__d("P2PPaymentRequestStatus",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({INITED:1,DECLINED:2,TRANSFER_INITED:3,TRANSFER_COMPLETED:4,TRANSFER_FAILED:5,CANCELED:6,EXPIRED:7})}),null);
__d("P2PTransferStatus",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({PENDING_SENDER_MANUAL_REVIEW:1,PENDING_SENDER_VERIFICATION:2,CANCELED_SENDER_RISK:3,PENDING_RECIPIENT_NUX:4,CANCELED_DECLINED:5,PENDING_RECIPIENT_VERIFICATION:6,PENDING_RECIPIENT_MANUAL_REVIEW:7,PENDING_RECIPIENT_PROCESSING:8,PENDING_PUSH_FAIL:9,CANCELED_RECIPIENT_RISK:10,CANCELED_SYSTEM_FAIL:11,CANCELED_EXPIRED:12,COMPLETED:13,INTERMEDIATE_PROCESSING:14,PENDING_SENDER_INITED:15,CANCELED_SAME_CARD:16,PENDING_SENDER_VERIFICATION_PROCESSING:17,PENDING_RECIPIENT_VERIFICATION_PROCESSING:18,CANCELED_SENDER_CANCEL:19,PENDING_SENDER_IDV_REVIEW:20,PENDING_RECEIVER_IDV_REVIEW:21})}),null);
__d("MMessagePayload",["fbt","ChannelEventType","CurrentUser","MercuryAttachmentSnippetRenderer","MercuryAudioType","P2PPaymentRequestStatus","P2PTransferStatus","formatDate"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=25,i=1e3,j="g:ia";a=function(){__p&&__p();function a(a){this.$1=a}var c=a.prototype;c.isPageMessage=function(){return this.$1.type===b("ChannelEventType").PAGES_MESSAGE};c.getThreadFBID=function(){return this.$1.thread_fbid&&this.$1.thread_fbid.toString()};c.getHref=function(){return this.$1.href};c.getAuthorFBID=function(){return this.$1.sender_fbid.toString()};c.getAuthorName=function(){return this.$1.sender_name};c.getThreadName=function(){return this.$1.thread_name};c.getThreadUnreadCount=function(){return this.$1.thread_unread_count};c.getSnippet=function(){__p&&__p();var a=this.$1.body;if(a)if(a.length>h)return g._("{shortened body}{dot dot dot (for truncation)}",[g._param("shortened body",a.substring(0,h)),g._param("dot dot dot (for truncation)","...")]);else return a;a=this.$1.attachments.map(function(a){__p&&__p();if(a.sticker_attachment)return{attach_type:"sticker",metadata:{stickerID:a.sticker_attachment.id}};else if(a.blob_attachment)if(a.blob_attachment.__typename==="MessageImage")if(a.blob_attachment.render_as_sticker)return{attach_type:"third_party_sticker"};else return{attach_type:"photo"};else if(a.blob_attachment.__typename==="MessageAnimatedImage")return{attach_type:"animated_image"};else if(a.blob_attachment.__typename==="MessageVideo")return{attach_type:"video"};else if(a.blob_attachment.audio_type&&(a.blob_attachment.audio_type==="VOICE_MESSAGE"||a.blob_attachment.audio_type==="VOICE_MESSAGE_WITH_TRANSCRIPT"))return{metadata:{type:b("MercuryAudioType").AudioClip}};else if(a.blob_attachment.__typename==="MessageFile")if(a.blob_attachment.is_malicious)return{attach_type:"error"};else return{attach_type:"file"};else return{attach_type:"unknown"};else if(a.extensible_attachment)if(a.extensible_attachment.story_attachment){var c;a=a.extensible_attachment.story_attachment;var d=a.target;c=(c=d)!=null?c.__typename:c;if(c==="MessengerBusinessMessage"){return{share:{style_list:a.style_list,target:{message:(a=d)!=null?a.message:a}},attach_type:"share"}}else if(c==="PeerToPeerPaymentRequest"){var e;a=(a=d)!=null?a.request_status:a;return{share:{style_list:["orion_request"],target:{requester:{id:(e=d)!=null?(e=e.requester)!=null?e.id:e:e,name:(e=d)!=null?(e=e.requester)!=null?e.short_name:e:e},amountWithSymbol:(e=d)!=null?(e=e.amount)!=null?e.formatted:e:e,currentStatus:a?b("P2PPaymentRequestStatus")[a]:null,requestee:{id:(e=d)!=null?(e=e.requestee)!=null?e.id:e:e,name:(a=d)!=null?(a=a.requestee)!=null?a.short_name:a:a}}},attach_type:"share"}}else if(c==="PeerToPeerTransfer"){a=(e=d)!=null?e.transfer_status:e;return{share:{style_list:["orion"],target:{sender:(e=d)!=null?e.sender:e,amountWithSymbol:(e=d)!=null?(e=e.transaction_amount)!=null?e.formatted_amount:e:e,status:a?b("P2PTransferStatus")[a]:null,receiver:{id:(e=d)!=null?(e=e.receiver_profile)!=null?e.id:e:e,name:(a=d)!=null?(a=a.receiver_profile)!=null?a.short_name:a:a}}},attach_type:"share"}}else if(c==="MessageLiveLocation")return{share:{style_list:["message_live_location"]},attach_type:"share"};else if(c==="MessageLocation")return{share:{style_list:["message_location"]},attach_type:"share"};return{attach_type:"share"}}else return{attach_type:"share"};else return{attach_type:"unknown"}});var c=b("MercuryAttachmentSnippetRenderer").getAttachmentSnippetType(a);return b("MercuryAttachmentSnippetRenderer").renderAttachmentSnippetText(c,this.getAuthorFBID()===b("CurrentUser").getID(),this.getAuthorName(),a)};c.getMessage=function(){return this.$1.body};c.getTime=function(){return b("formatDate")(this.$1.timestamp/i,j)};c.getTimestamp=function(){return this.$1.timestamp.toString()};c.getUUID=function(){return this.$1.message_id};c.getFolder=function(){return this.$1.folder};c.getMessageSource=function(){return this.$1.source};c.getParticipantIDs=function(){var a=this.$1.participant_ids||[];return a.map(function(a){return a.toString()})};c.hasThreadImage=function(){return this.$1.has_thread_image};c.hasWorkForeignParticipants=function(){return this.$1.work_foreign_participant_ids&&this.$1.work_foreign_participant_ids.length>0};c.getWorkForeignParticipantIds=function(){return this.$1.work_foreign_participant_ids};c.getAttachmentCount=function(){return this.$1.attachments.length};c.getAttachments=function(){return this.$1.attachments};c.isCanonicalThread=function(){return!!this.$1.is_canonical};c.isUnread=function(){return this.$1.is_unread};c.getOtherUserFBID=function(){var a=this.$1.participant_ids;if(!this.isCanonicalThread())return null;else if(a.length===1)return a[0].toString();else return a[0].toString()===b("CurrentUser").getID()?this.isPageMessage()?a[0].toString():a[1].toString():a[0].toString()};c.getThreadNameWithUnreadCount=function(){return!this.getThreadUnreadCount()?this.getThreadName():g._("{thread name} ({unread count})",[g._param("thread name",this.getThreadName()),g._param("unread count",this.getThreadUnreadCount())])};return a}();e.exports=a}),null);
__d("MMessageServerResourceFetcher",["KeyedCallbackManager","MRequest"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a,c){this.$3=a,this.$4=c,this.$1=new(b("KeyedCallbackManager"))(),this.$2={}}var c=a.prototype;c.get=function(a,b){this.getMulti([a],function(c){b(c[a])})};c.getMulti=function(a,c){__p&&__p();var d=this;c=!this.$1.executeOrEnqueue(a,c);if(c)return;var e=a.filter(function(a){var b=!d.$1.getResource(a)&&!d.$2[a];b&&(d.$2[a]=!0);return b});if(e.length===0)return;c=new(b("MRequest"))(this.$3(e)).setMethod("POST");c.listen("done",function(a){if(!a||!a.payload)return;a=d.$4(a.payload);a&&d.$1.addResourcesAndExecute(a)});c.listen("finally",function(a){e.forEach(function(){delete d.$2[a]})});c.send()};c.set=function(a,b){var c={};c[a]=b;this.$1.addResourcesAndExecute(c)};return a}();e.exports=a}),null);
__d("MercurySingletonProvider",["CurrentUser"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a){this.$1={},this.$2=a}var c=a.prototype;c.getForFBID=function(a){this.$1[a]||(this.$1[a]=new this.$2(a));return this.$1[a]};c.get=function(){return this.getForFBID(b("CurrentUser").getID())};a.mock=function(a){throw new Error("MercurySingletonProvider.mock() must only be used in tests.")};return a}();e.exports=a}),null);
__d("XChatThreadInfoAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/chat/thread_info/",{thread_fbids:{type:"StringVector",defaultValue:[]},other_user_fbids:{type:"StringVector",defaultValue:[]}})}),null);
__d("MMessagesThreadDataStore",["ActorURI","CurrentUser","MercurySingletonProvider","MMessageServerResourceFetcher","XChatThreadInfoAsyncController"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=null;a=function(){__p&&__p();a.getProvider=function(){g===null&&(g=new(b("MercurySingletonProvider"))(a));return g};a.getForFBID=function(b){return a.getProvider().getForFBID(b)};a.get=function(){return a.getProvider().get()};function a(a){this.$6=a,this.$1=new(b("MMessageServerResourceFetcher"))(function(c){c=b("XChatThreadInfoAsyncController").getURIBuilder().setStringVector("other_user_fbids",c).getURI();b("CurrentUser").getID()!==a&&(c=b("ActorURI").create(c,a));return c.toString()},function(a){return a.profiles}),this.$2=new(b("MMessageServerResourceFetcher"))(function(c){c=b("XChatThreadInfoAsyncController").getURIBuilder().setStringVector("thread_fbids",c).getURI();b("CurrentUser").getID()!==a&&(c=b("ActorURI").create(c,a));return c.toString()},function(a){return a.profiles}),this.$3={},this.$5={},this.$4={}}var c=a.prototype;c.$7=function(a,b){if(a)return this.$1;else return this.$2};c.getForNewMessage=function(a,b,c,d,e){var f=this,g=this.$7(a,b),h=a||b;g.get(h,function(a){f.$3[h]===void 0?(f.$3[h]=a.unread_count,delete a.unread_count,f.$5[c]=!0):f.$5[c]||(delete a.unread_count,f.$5[c]=!0,d?f.$3[h]=f.$3[h]+1:f.$3[h]=0),f.$4[h]===void 0&&(f.$4[h]=a.pages_is_flagged),a.thread_unread_count=f.$3[h],e(a)})};c.updateFlagStatus=function(a,b,c,d){var e=this;if(typeof c!=="boolean")return;var f=this.$7(a,b),g=a||b;f.get(g,function(a){e.$4[g]=c,d()})};c.getIsThreadFlagged=function(a,b){a=a||b;return this.$4[a]};c.clearUnreadCount=function(a,b,c){var d=this,e=this.$7(a,b),f=a||b;e.get(f,function(a){d.$3[f]=0,c()})};c.clearAllUnread=function(){this.$3={}};return a}();e.exports=a}),null);
__d("XChatUserInfoAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/chat/user_info/",{ids:{type:"IntVector",defaultValue:[]}})}),null);
__d("MShortProfiles",["MMessageServerResourceFetcher","XChatUserInfoAsyncController"],(function(a,b,c,d,e,f){"use strict";var g=new(b("MMessageServerResourceFetcher"))(function(a){return b("XChatUserInfoAsyncController").getURIBuilder().setIntVector("ids",a.map(Number)).getURI().toString()},function(a){return a.profiles});a={get:function(a,b){g.get(a,b)},getMulti:function(a,b){g.getMulti(a,b)},set:function(a,b){g.set(a,b)}};e.exports=a}),null);
__d("MMessagesChannelPayloadPreparer",["Promise","MercuryIDs","MMessagePayload","MMessagesConfig","MMessagesThreadDataStore","MShortProfiles","Stratcom","promiseDone"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={fetchDataThenDispatch:function(a){__p&&__p();a.message.folder=a.folder;a.message.sender_fbid=b("MercuryIDs").getUserIDFromParticipantID(a.message.author);b("MMessagesConfig").msite_genie_xma_rendering&&this._processGenieMessage(a.message);var c=a.targetFBID?a.targetFBID:a.realtime_viewer_fbid.toString(),d=[new(b("Promise"))(function(d,e){e=b("MMessagesThreadDataStore").getForFBID(c);e.getForNewMessage(a.message.other_user_fbid,a.message.thread_fbid,a.message.message_id,a.message.is_unread,function(a){d(a)})}),new(b("Promise"))(function(c,d){b("MShortProfiles").get(a.message.sender_fbid.toString(),function(a){c(a)})})];b("promiseDone")(b("Promise").all(d),function(c){var d=c[0];c=c[1];Object.assign(a.message,{is_muted:d.mute_until!==void 0,thread_name:d.thread_name,participant_ids:d.participant_ids,has_thread_image:d.has_thread_image,work_foreign_participant_ids:d.work_foreign_participant_ids,is_canonical:d.is_canonical,href:d.href,thread_unread_count:d.thread_unread_count,pages_is_flagged:d.pages_is_flagged,sender_name:c.name,type:a.type});a.parsedPayload=new(b("MMessagePayload"))(a.message);b("Stratcom").invoke(a.type,null,a)})},_processGenieMessage:function(a){__p&&__p();if(!a.has_attachment||!a.attachments)return;for(var b=a.attachments.length-1;b>=0;b-=1){var c=a.attachments[b];if(!c.share||!c.share.style_list||c.share.style_list[0]!="genie_message")continue;c.share.target.genie_id&&(a.sender_fbid=c.share.target.genie_id,a.sender="fbid:"+c.share.target.genie_id);c.share.target.genie_name&&(a.sender_name=c.share.target.genie_name);c.share.target&&!c.share.target.attachment&&(a.attachments.splice(b,1),a.has_attachment=a.attachments.length>0)}}};e.exports=a}),null);
__d("MGenericJewel",["CSS","Event","MHistory","MJewels","MParent","MViewport","ScriptPath","Stratcom","SubscriptionsHandler"],(function(a,b,c,d,e,f){__p&&__p();var g={};function a(a,c,d,e){__p&&__p();if(g[a])return;var f=new(b("SubscriptionsHandler"))();g[a]=f;var h,i;f.addSubscriptions(b("Event").listen(c,"click",function(c){b("MParent").bySigil(c.target,"icon")&&(c.preventDefault(),!h?(b("MHistory").pushSoftState(a),b("Stratcom").invoke("MGenericJewel::clicked",a,{open:!0})):a===b("MJewels").SEARCH&&b("Stratcom").invoke("m:chrome:tab:show",a,{open:!0}),b("ScriptPath").set("topbar_"+a))}),b("Stratcom").listen("m:history:change",null,function(e){var f=e.getData().soft===a;!f&&(h||i)&&b("Stratcom").invoke("m:chrome:tab:hide",a);b("CSS").conditionClass(c,"popoverOpen",f);d&&!j&&(b("CSS").conditionClass(d,"popover_hidden",!f),b("CSS").conditionClass(d,"popover_visible",f),f&&(d.style.minHeight=b("MViewport").getUseableHeight()+"px"));f&&!h&&(b("Stratcom").invoke("m:chrome:tab:show",a),b("CSS").addClass(c,"noCount"),b("CSS").removeClass(c,"hasCount"));i=e.getData().soft===void 0;h=f}));var j=!1;a===b("MJewels").SEARCH&&d&&f.addSubscriptions(b("Stratcom").listen("m:graph-search:rendered",null,function(){b("CSS").conditionClass(d,"popover_hidden",!0),j=!0}));e&&f.addSubscriptions(b("Stratcom").listen("m:page:unload",null,function(){f.release(),g[a]=void 0}))}e.exports={init:a}}),null);
__d("MJewelSet",["MViewport","Popover","ScriptPath","Stratcom"],(function(a,b,c,d,e,f){__p&&__p();var g={_haveInitializedJewels:!1,init:function(){if(g._haveInitializedJewels)return;g._haveInitializedJewels=!0;b("Stratcom").listen("m:viewport:orientation-change",null,g._onOrientationChange);b("Stratcom").listen("m:jewel:flyout:open",null,g._onJewelOpen)},_onJewelOpen:function(a){a=a.getData();b("ScriptPath").set("topbar_"+a.jewel)},_onOrientationChange:function(){setTimeout(function(){var a=b("Popover")._activePopover;if(!a)return;b("MViewport").getHeight()+"px"!==a.flyout.style.minHeight&&a.refreshConstraints()},800)}};e.exports=g}),null);
__d("MJewelsTabability",["DOM","Stratcom"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={_initialized:!1,initAllJewels:function(a){if(g._initialized)return;g._initialized=!0;a=b("DOM").scry(a.bluebar,"a","jewel-link");for(var c=0;c<a.length;++c)g.listen(a[c],!0)},listen:function(a,c,d){var e=c?"m:backnav:show-jewels":"m:backnav:show-backbar";c=c?"m:backnav:show-backbar":"m:backnav:show-jewels";b("Stratcom").listen(e,null,function(){d!==void 0&&d!==null&&d!==""?g.setTabIndex(a,d):g.removeTabIndex(a)});b("Stratcom").listen(c,null,function(){g.setTabIndex(a,"-1")})},setTabIndex:function(a,b){a.setAttribute("tabindex",b),b==="-1"&&a.setAttribute("aria-hidden","true")},removeTabIndex:function(a){a.removeAttribute("tabindex"),a.removeAttribute("aria-hidden")}};e.exports=g}),null);
__d("MBookmarksJewelClickTracking",["DOM","Event","MJewelsLogger","Stratcom","ge"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=!1,h=!1,i=!0;function a(a){__p&&__p();if(g)return;g=!0;var c=b("DOM").find(b("ge")("mJewelNav"),"div","bookmarks"),d=!!a.noFlyout;b("Event").listen(c,"click",function(){i&&(b("MJewelsLogger").markJewelClick("bookmarks",{isFirstClick:!h,badgeCount:0,jewelBehavior:d?"permalink":"flyout",isPrefetching:!1,initialPrefetchPhase:null}),i=!1),h=!0});b("Stratcom").listen("m:side-area:show",null,function(){b("MJewelsLogger").markJewelDisplayed("bookmarks")});b("Stratcom").listen("m:side-area:hide",null,function(){i=!0})}e.exports={init:a}}),null);
__d("XFeedNewStoriesBadgeController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/feed/badge/",{})}),null);
__d("MOutOfFeedNewStoriesPolling",["Arbiter","MHome","MRequest","Stratcom","TimeSlice","XFeedNewStoriesBadgeController","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=null,h=0,i=!1,j=new(b("Arbiter"))(),k=9,l=15e3;function m(){if(h>k)return;clearTimeout(g);g=b("setTimeoutAcrossTransitions")(b("TimeSlice").guard(function(){n()},"Feed jewel count polling",{propagationType:b("TimeSlice").PropagationType.ORPHAN}),l)}function n(){var a=b("XFeedNewStoriesBadgeController").getURIBuilder().getURI();a=new(b("MRequest"))(a);a.listen("done",function(a){p(a.payload.count)});a.listen("finally",function(){a=null,m()});a.send()}function o(){p(0),clearTimeout(g),g=null}function p(a){h=a,j.inform("MOutOfFeedNewStoriesPolling/updateCount",{count:a},"state")}function a(a){q();return j.subscribe("MOutOfFeedNewStoriesPolling/updateCount",a)}function q(){if(i)return;i=!0;b("Stratcom").listen("m:homepage:load",null,function(){o()});b("Stratcom").listen("m:homepage:unload",null,function(){m()});b("MHome").isHome(location.href)||m()}e.exports={addPollingListener:a,MAX_COUNT:k}}),null);
__d("MFeedJewel",["CSS","DOM","MHistory","MJewel","MJewelLinkFetcher","MJewels","MOutOfFeedNewStoriesPolling","MPageController","MURI","Stratcom","SubscriptionsHandler","$","formatNumber"],(function(a,b,c,d,e,f){__p&&__p();var g,h,i,j;function k(a){b("CSS").conditionClass(j,"popoverOpen",!0)}function l(a){b("CSS").conditionClass(j,"popoverOpen",!1)}function m(){if(i)return;i=new(b("SubscriptionsHandler"))();i.addSubscriptions(b("Stratcom").listen("m:history:change",null,o))}function n(){i&&i.release(),i=null}function o(a){a=a.getData().soft;for(var c=0,d=Object.keys(b("MJewels"));c<d.length;c++)if(b("MJewels")[d[c]]===a){l();return}k()}function p(a){return new(b("MURI"))(a).normalize().toString()}function q(a){var c=b("MJewelLinkFetcher").get("feed");if(!c)return;c=p(c);var d=p(b("MHistory").getPath());c===d&&(a.kill(),b("MPageController").reload())}function r(a){var c=b("formatNumber").withMaxLimit(a,b("MOutOfFeedNewStoriesPolling").MAX_COUNT);b("DOM").setContent(g,c);b("CSS").conditionClass(j,"noCount",a===0);b("CSS").conditionClass(j,"hasCount",a>0);b("CSS").conditionClass(j,"largeCount",c.length>1);b("Stratcom").invoke("m:feed:jewel:badge-count-change",null,{jewel:j,count:a})}function s(a){b("Stratcom").listen("m:homepage:load",null,function(){k(),m()}),b("Stratcom").listen("m:homepage:unload",null,function(){l(),n()}),a&&m()}function a(a,c,d){if(h)return;h=!0;j=a;g=b("DOM").find(j,"span","count");s(c);b("DOM").listen(b("$")(b("MJewel").JEWEL_NAV_NODE_ID),"click","feed",q);g&&b("MOutOfFeedNewStoriesPolling").addPollingListener(function(a,b){return r(b.count)})}e.exports={init:a}}),null);
__d("XBookmarksFlyoutBodyController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/bookmarks/flyout/body/",{id:{type:"String",required:!0}})}),null);
__d("MChromeTabsBootloader",["MJewels","MRequest","Stratcom","XBookmarksFlyoutBodyController"],(function(a,b,c,d,e,f){a={bootloadBookmarks:function(a){b("Stratcom").listen(["m:chrome:tab:show","m:jewel:flyout:open"],b("MJewels").BOOKMARKS,function(){b("Stratcom").removeCurrentListener(),new(b("MRequest"))(b("XBookmarksFlyoutBodyController").getURIBuilder().setString("id",a).getURI()).send()})}};e.exports=a}),null);
__d("MTitleListener",["FBLogger","Stratcom"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=!1,h=null,i="",j=!0;function k(){__p&&__p();if(h)return h;var a=document.getElementsByTagName("head");if(!a||!a.length)return null;a=a[0].getElementsByTagName("title");if(!a||!a.length)return null;a=a[0];if(a){a=a.childNodes;a&&a.length&&(h=a[0])}return h}function l(){var a=k();return!a?i:a.nodeValue||i}function m(a){i=a||"";typeof i!=="string"&&(i=String(i));a=k();a&&(a.nodeValue=i);b("Stratcom").invoke("MDocument:title",null,i)}e.exports={getTitle:function(){var a=document.title||i||"";a=typeof a==="string"?a:String(a);return a},getTitleAsString:function(a){a=a===null||a===void 0||typeof a==="object"?this.getTitle():a;a=typeof a==="string"?a:String(a);return a||""},init:function(){__p&&__p();if(g)return j;i=document.title||"";var a={get:function(){return l()},set:function(a){m(a)},enumerable:!0};try{Object.defineProperty(document,"title",a),j=!0}catch(a){j=!1}g=!0;return j}}}),null);
__d("MMessagesReadReceipts",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=void 0,h={};function a(a,b){g=a,h=b}function b(a,b){if(a!==g)return;for(var c in b){if(!Object.prototype.hasOwnProperty.call(b,c))continue;a=b[c].action;var d=h[c].action;d===void 0?h[c]=b[c]:h[c]=Math.max(d,a)===d?h[c]:b[c]}}function c(a,b,c){__p&&__p();if(a!==g)return{};a={};for(var d in h){if(!Object.prototype.hasOwnProperty.call(h,d))continue;else if(c.indexOf(d)!==-1)continue;else if(h[d].action<b)continue;a[d]=h[d].action}return a}e.exports={init:a,update:b,getSeenBy:c}}),null);
__d("MercuryMessageCustomizations",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=JSON.parse(a),c=[];Object.keys(b).forEach(function(a){c.push({customization_type:a,customization_value:b[a]})});return c}e.exports={parseCustomizations:a}}),null);
__d("MercuryProfileRanges",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function g(a){return!a.id&&a.i?{id:a.i,offset:a.o,length:a.l}:a}e.exports={extractFromDelta:function(a){a=(a=a)!=null?(a=a.data)!=null?a.prng:a:a;if(!a)return[];var b=[];try{b=JSON.parse(a);if(b.length>0)return b.map(g)}catch(a){}return b}}}),null);
__d("MessageThreadReadState",[],(function(a,b,c,d,e,f){"use strict";a={MARK_READ:1,MARK_UNREAD:2,KEEP_AS_IS:3};e.exports=a}),null);
__d("MessageThreadReadStateEffect",["MessageThreadReadState"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a,c){var d=c.messageMetadata.threadReadStateEffect;if(d!=null){var e=b("MessageThreadReadState")[d];return e===void 0&&typeof d==="number"?d:e}d=c.messageMetadata.skipBumpThread;return d===!0?b("MessageThreadReadState").KEEP_AS_IS:a!==c.messageMetadata.actorFbId?b("MessageThreadReadState").MARK_UNREAD:b("MessageThreadReadState").KEEP_AS_IS};e.exports={extractThreadStateEffectFromDelta:a}}),null);
__d("MMercurySyncNewMessageTransformer",["IrisProtocolMessageLifetime","MercuryIDs","MercuryMessageCustomizations","MercuryProfileRanges","MessageThreadReadState","MessageThreadReadStateEffect","MessagingTag"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("MessageThreadReadStateEffect").extractThreadStateEffectFromDelta,h=function(a){var b={};try{b=JSON.parse(a)}catch(a){}return b instanceof Array?b[0]:b};function a(a,c){var d=parseInt(c.messageMetadata.timestamp,10),e=c.messageMetadata.skipBumpThread,f=g(a,c);a=f===b("MessageThreadReadState").MARK_UNREAD&&a!==c.messageMetadata.actorFbId;var i=[];c.attachments&&(i=c.attachments.map(function(a){return a.mercury}));var j=c.messageMetadata.tags?c.messageMetadata.tags[0]:void 0;return{message_id:c.messageMetadata.messageId,threading_id:null,offline_threading_id:c.messageMetadata.offlineThreadingId,author:b("MercuryIDs").getParticipantIDFromUserID(c.messageMetadata.actorFbId),author_email:c.messageMetadata.actorFbId+"@facebook.com",ephemeral_ttl_mode:c.ttl?b("IrisProtocolMessageLifetime")[c.ttl]:0,timestamp:d,is_unread:a,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_filtered_content_quasar:!1,is_filtered_content_invalid_app:!1,source:j,tags:c.messageMetadata.tags,is_spoof_warning:!1,folder:b("MessagingTag").INBOX,thread_fbid:c.messageMetadata.threadKey.threadFbId,other_user_fbid:c.messageMetadata.threadKey.otherUserFbId,body:c.body!==void 0?c.body:"",html_body:null,subject:null,has_attachment:i.length>0,attachments:i,ranges:void 0,thread_id:null,action_type:"ma-type:user-generated-message",is_from_iris:!0,is_sponsored:!!(c.data&&c.data.is_sponsored&&c.data.is_sponsored==="true")||!!(c.untypedData&&c.untypedData.is_sponsored&&c.untypedData.is_sponsored==="true"),commerce_message_type:c.data?c.data.commerce_message_type:null,customizations:c.data&&c.data.customization?b("MercuryMessageCustomizations").parseCustomizations(c.data.customization):null,platform_xmd:c.data&&c.data.platform_xmd?c.data.platform_xmd:null,profile_ranges:b("MercuryProfileRanges").extractFromDelta(c),message_source:c.data&&c.data.message_source_data?h(c.data.message_source_data).message_source:null,skip_bump_thread:e,thread_read_state_effect:f,montage_reply_data:c.data&&c.data.montage_reply_data?h(c.data.montage_reply_data):null,meta_ranges:c.data&&c.data.meta_ranges?h(c.data.meta_ranges):null}}e.exports={transform:a}}),null);
__d("MMercurySyncReplaceMessageTransformer",["MMercurySyncNewMessageTransformer"],(function(a,b,c,d,e,f){"use strict";function a(a,c){c=Object.assign({},c.newMessage,c);return Object.assign(b("MMercurySyncNewMessageTransformer").transform(a,c),{action_type:"ma-type:replace-message",replaced_message_id:c.replacedMessageId})}e.exports={transform:a}}),null);
__d("MMercuryUnsendMessageProcessor",[],(function(a,b,c,d,e,f){"use strict";function a(){document.location.reload()}e.exports={process:a}}),null);
__d("MReplaceMessageProcessor",[],(function(a,b,c,d,e,f){"use strict";function a(a){}e.exports={process:a}}),null);
__d("MercurySyncDeltaTypes",[],(function(a,b,c,d,e,f){"use strict";a={AdminAddedToGroupThread:"AdminAddedToGroupThread",AdminRemovedFromGroupThread:"AdminRemovedFromGroupThread",AdminTextMessage:"AdminTextMessage",ChangeViewerStatus:"ChangeViewerStatus",DeliveryReceipt:"DeliveryReceipt",ForcedFetch:"ForcedFetch",MarkRead:"MarkRead",MarkUnread:"MarkUnread",MarkFolderSeen:"MarkFolderSeen",MessageDelete:"MessageDelete",NewMessage:"NewMessage",NoOp:"NoOp",PagesManagerEvent:"PagesManagerEvent",ParticipantLeftGroupThread:"ParticipantLeftGroupThread",ParticipantsAddedToGroupThread:"ParticipantsAddedToGroupThread",ReadReceipt:"ReadReceipt",ReplaceMessage:"ReplaceMessage",RTCEventLog:"RTCEventLog",ThreadAction:"ThreadAction",ThreadDelete:"ThreadDelete",ThreadFolder:"ThreadFolder",ThreadMuteSettings:"ThreadMuteSettings",ThreadName:"ThreadName",JoinableMode:"JoinableMode",ApprovalMode:"ApprovalMode",ApprovalQueue:"ApprovalQueue",ClientPayload:"ClientPayload",GenieMessage:"GenieMessage",MontageMessage:"MontageMessage",RtcCallData:"RtcCallData"};e.exports=a}),null);
__d("MercurySyncMarkFolderSeenTransformer",["MessagingTag"],(function(a,b,c,d,e,f){"use strict";function a(a){return a.folders.map(function(c){return{action_type:"mga-type:mark-all-seen",folder:b("MessagingTag").IRIS_MAPPING[c],timestamp:parseInt(a.timestamp,10)}})}e.exports={transform:a}}),null);
__d("MercurySyncMarkReadTransformer",["MessagingTag"],(function(a,b,c,d,e,f){"use strict";function a(a){return a.folders&&a.folders.length>0?a.folders.map(function(c){return{action_type:"mga-type:mark-all-read",action_id:null,folder:b("MessagingTag").IRIS_MAPPING[c],timestamp:parseInt(a.watermarkTimestamp,10)}}):a.threadKeys.map(function(c){return{action_type:"ma-type:change_read_status",other_user_fbid:c.otherUserFbId,thread_fbid:c.threadFbId,mark_as_read:!0,timestamp:parseInt(a.watermarkTimestamp,10),folder:b("MessagingTag").INBOX}})}e.exports={transform:a}}),null);
__d("MercurySyncMarkUnreadTransformer",["MessagingTag"],(function(a,b,c,d,e,f){"use strict";function a(a){return a.threadKeys.map(function(c){return{action_type:"ma-type:change_read_status",other_user_fbid:c.otherUserFbId,thread_fbid:c.threadFbId,mark_as_read:!1,timestamp:parseInt(a.watermarkTimestamp,10),folder:b("MessagingTag").INBOX}})}e.exports={transform:a}}),null);
__d("MercurySyncPagesManagerEventTransformer",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){var b=JSON.parse(a.jsonBlob),c=b&&b.type;if(!c)return void 0;switch(c){case 1:c=!!(b&&b.flagData&&b.flagData.state);b={action_type:"ma-type:change_flag",mark_as_flag:c,other_user_fbid:a.threadKey.otherUserFbId,thread_fbid:a.threadKey.threadFbId};return b;default:return void 0}}e.exports={transform:a}}),null);
__d("MercurySyncReadReceiptTransformer",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b={watermark:parseInt(a.watermarkTimestampMs,10),action:parseInt(a.actionTimestampMs,10)},c=a.threadKey.otherUserFbId||a.actorFbId;a=a.threadKey.otherUserFbId||a.threadKey.threadFbId;var d={roger:{}};d.roger[a]={};d.roger[a][c]=b;return d}e.exports={transform:a}}),null);
__d("MMercurySyncDispatcher",["BanzaiODS","ChannelEventType","CurrentUser","MercurySingletonProvider","MercurySyncDeltaTypes","MercurySyncMarkFolderSeenTransformer","MercurySyncMarkReadTransformer","MercurySyncMarkUnreadTransformer","MercurySyncPagesManagerEventTransformer","MercurySyncReadReceiptTransformer","MessagingTag","MMercurySyncNewMessageTransformer","MMercurySyncReplaceMessageTransformer","MMercuryUnsendMessageProcessor","MMessagesChannelPayloadPreparer","MMessagesReadReceipts","MMessagesThreadDataStore","MReplaceMessageProcessor","Stratcom","emptyFunction","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=null;a=function(){__p&&__p();a.getProvider=function(){g===null&&(g=new(b("MercurySingletonProvider"))(a));return g};a.getForFBID=function(b){return a.getProvider().getForFBID(b)};a.get=function(){return a.getProvider().get()};function a(a){this.$1=a,this.$2=b("CurrentUser").getAccountID()===this.$1?b("ChannelEventType").MESSAGE:b("ChannelEventType").PAGES_MESSAGE}var c=a.prototype;c.process=function(a,c){__p&&__p();var d=this,e="none";a!=null&&a["class"]!=null&&a["class"]!=""&&(e=a["class"]);b("BanzaiODS").bumpEntityKey(2966,"SyncDispatcher","receive."+c+"."+e);e=b("gkx")("942685");if(e&&c==="cp")return;else if(!e&&c==="mqtt")return;switch(a["class"]){case b("MercurySyncDeltaTypes").NewMessage:e=b("MMercurySyncNewMessageTransformer").transform(this.$1,a);c={message:e,type:this.$2,folder:b("MessagingTag").INBOX,targetFBID:this.$1};b("MMessagesChannelPayloadPreparer").fetchDataThenDispatch(c);break;case b("MercurySyncDeltaTypes").MarkUnread:e=b("MercurySyncMarkUnreadTransformer").transform(a);e.map(function(a){c={message:a,type:d.$2,event:"unread",is_sync:!0,targetFBID:d.$1},b("Stratcom").invoke(c.type,null,c)});break;case b("MercurySyncDeltaTypes").MarkRead:e=b("MercurySyncMarkReadTransformer").transform(a);e.map(function(a){a.action_type==="mga-type:mark-all-read"?b("MMessagesThreadDataStore").getForFBID(d.$1).clearAllUnread():b("MMessagesThreadDataStore").getForFBID(d.$1).clearUnreadCount(a.other_user_fbid,a.thread_fbid,b("emptyFunction")),c={message:a,type:d.$2,event:a.action_type==="mga-type:mark-all-read"?"mark_all_read":"read",is_sync:!0,targetFBID:d.$1},b("Stratcom").invoke(c.type,null,c)});break;case b("MercurySyncDeltaTypes").MarkFolderSeen:e=b("MercurySyncMarkFolderSeenTransformer").transform(a);e.map(function(a){c={message:a,type:d.$2,event:"mark_all_seen",is_sync:!0,targetFBID:d.$1},b("Stratcom").invoke(c.type,null,c)});break;case b("MercurySyncDeltaTypes").ReadReceipt:e=b("MercurySyncReadReceiptTransformer").transform(a);var f=Object.keys(e.roger)[0],g=e.roger[f];b("MMessagesReadReceipts").update(f,g);c={message:e,type:this.$2,event:"read_receipt",is_sync:!0,targetFBID:this.$1};b("Stratcom").invoke(c.type,null,c);break;case b("MercurySyncDeltaTypes").PagesManagerEvent:e=b("MercurySyncPagesManagerEventTransformer").transform(a);if(!e||e.action_type!=="ma-type:change_flag")return;b("MMessagesThreadDataStore").getForFBID(this.$1).updateFlagStatus(e.other_user_fbid,null,e.mark_as_flag,b("emptyFunction"));c={event:b("ChannelEventType").PAGE_THREAD_FLAG_CHANGED,flagged:e.mark_as_flag,other_user_fbid:e.other_user_fbid,type:b("ChannelEventType").PAGES_MESSAGE};b("Stratcom").invoke(c.type,null,c);break;case b("MercurySyncDeltaTypes").ReplaceMessage:e=b("MMercurySyncReplaceMessageTransformer").transform(this.$1,a);c={message:e,type:this.$2,folder:b("MessagingTag").INBOX,targetFBID:this.$1};b("MReplaceMessageProcessor").process(c);break;case b("MercurySyncDeltaTypes").ClientPayload:f=JSON.parse(String.fromCharCode.apply(null,a.payload));g=f&&f.deltas;if(g.length>0){a=g[0];if(a.deltaMessageReply){f=a.deltaMessageReply.message;e=b("MMercurySyncNewMessageTransformer").transform(this.$1,f);c={message:e,type:this.$2,folder:b("MessagingTag").INBOX,targetFBID:this.$1};b("MMessagesChannelPayloadPreparer").fetchDataThenDispatch(c)}a.deltaRecallMessageData&&b("MMercuryUnsendMessageProcessor").process()}break;default:break}};return a}();e.exports=a}),null);
__d("SyncProtocolConstants",[],(function(a,b,c,d,e,f){a={IRIS_CURSOR_LIMIT:"IRIS_CURSOR_LIMIT",SNAPSHOT_FAILURE:"SNAPSHOT_FAILURE"};e.exports=a}),null);
__d("SyncProtocolClient",["Int64","MercurySingletonProvider","MqttEnv","SyncProtocolConstants","exponentialBackoff"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("MqttEnv").Env;a=function(){__p&&__p();a.getForFBID=function(a){return h.getForFBID(a)};function a(a){var c=this;this.$1=a;this.$2=[];this.$5=g.getLoggerInstance();this.$10=new(b("exponentialBackoff"))(function(){return c.$11()},this)}var c=a.prototype;c.getPublishMessages=function(){return this.$12()};c.init=function(a,c,d,e){__p&&__p();var f=this;if(!c&&!e){this.$5.bumpCounter("sp_init_invalid_parameter");return this}this.$9=a;this.$8=!0;this.$3=c?b("Int64").fromString(c):null;this.$6=d;this.$7=e;this.$4=null;this.$9.subscribe("/t_ms",function(a){return f.$13(a)});this.$9.subscribe("/thread_typing",function(a){f.$14(a)});this.$9.subscribe("/orca_typing_notifications",function(a){f.$14(a)});this.$9.subscribe("/notify_disconnect",function(a){return f.$15(a)});this.connectToIris();return this};c.connectToIris=function(a){a===void 0&&(a=null),a!==null&&(this.$3=b("Int64").fromString(a)),this.$8=!0,this.$9.registerExtraConnectPayloadProvider(this)};c.$12=function(){__p&&__p();var a;if(this.$4){if(!this.$3){this.$5.bumpCounter("connect_payload_iris_no_seq_id");return[]}a=this.$16()}else a=this.$17();this.$5.debugTrace("Sending request with MQTT Connect",JSON.stringify({topic:a.topic,payload:a.payload}));return[a]};c.$11=function(){__p&&__p();var a;if(this.$4){if(!this.$3){this.$5.bumpCounter("subscribe_to_iris_no_seq_id");return}a=this.$16()}else a=this.$17();this.$5.debugTrace("Sending request",JSON.stringify({topic:a.topic,payload:a.payload}));this.$9.publish(a.topic,a.payload,{qos:1,skipBuffer:!0})};c.$18=function(a){var b=null;try{b=JSON.parse(a)}catch(a){this.$5.logError(a,"Unable to process data")}return b};c.$14=function(a){var b=this.$18(a);if(b==null){this.$5.logWarn("_processTypingData","Unable to process typing data");return}this.$2.forEach(function(a){typeof a.onTypingReceived==="function"&&a.onTypingReceived(b)})};c.addDeltaStreamListener=function(a){this.$2.push(a)};c.$15=function(a){this.$5.logWarn("_handleNotifyDisconnect","Disconnecting reason: "+a),this.$5.bumpCounter("notify_disconnect_"+a),a===b("SyncProtocolConstants").IRIS_CURSOR_LIMIT&&this.$19(a)};c.$19=function(a){this.$5.bumpCounter(a+"_request"),this.$4=null,this.$8=!1,this.$9.unregisterExtraConnectPayloadProvider(this),this.$2.forEach(function(b){return b.onStreamDisconnect(a)})};c.$13=function(a){a=this.$18(a);if(a==null){this.$5.logWarn("_processDeltas","Unable to process delta");return}var b={syncToken:a.syncToken,entityId:a.queueEntityId,errorCode:a.errorCode,firstSeqId:a.firstDeltaSeqId,lastSeqId:a.lastIssuedSeqId};this.$5.debugTrace("Sync data received",JSON.stringify(b));b=this.$1;a.queueEntityId!=null&&a.queueEntityId!=b?this.$5.bumpCounter("delta_for_other_fbid"):a.syncToken?this.$20(a):a.queueEntityId==null?this.$5.bumpCounter("no_fbid"):a.errorCode?this.$21(a.errorCode):this.$22(a)};c.$21=function(a){this.$5.bumpCounter("iris_queue_error."+a),this.$5.logWarn("_handleIrisError","Recevied an error code from sync protocol "+a),a==="ERROR_QUEUE_TEMPORARY_NOT_AVAILABLE"?this.$10():this.$19(a)};c.$20=function(a){var c=this,d=b("Int64").fromString(a.firstDeltaSeqId.toString());(this.$3===null||this.$3!=null&&!this.$3.equals(d))&&this.$5.bumpCounter("initial_sequence_id_mismatch");this.$4=a.syncToken;this.$3=d;this.$5.debugTrace("Sync token received",JSON.stringify({token:this.$4}));this.$9.subscribeChannelEvents({onMQTTStateChanged:function(a){a==="Connected"&&c.$10.reset()}})};c.$22=function(a){var c=a.deltas,d=this.$3;if(c&&d){var e=b("Int64").fromString(a.firstDeltaSeqId.toString());a=b("Int64").fromString(a.lastIssuedSeqId.toString());e.equals(d.add(b("Int64").ONE))?this.$23(e,a,c):e.compare(d)<0?(this.$5.bumpCounter("delta_batch_in_middle"),a.compare(d)>0&&this.$23(d.add(b("Int64").ONE),a,c)):(this.$5.bumpCounter("missing_deltas_get_diffs"),this.$11())}else this.$5.bumpCounter("process_deltas_invalid_state")};c.$23=function(a,c,d){__p&&__p();a=a;for(var e=0;e<d.length;e++){var f=d[e],g=f["class"]||"Missing",h={seqId:a.toString(),type:g,status:""},i=1;if(g!="Missing")try{i=this.$24(f,g,a,h)}catch(a){h.status="err:"+a.message}else h.status="no type",this.$5.bumpCounter("missing_delta_type");this.$5.debugTrace("onDeltaReceived",JSON.stringify(h));a=a.add(b("Int64").fromInt(i))}this.$3=c};c.$24=function(a,c,d,e){__p&&__p();var f=1,g="";c==="NoOp"&&(f=a.numNoOps||f,g+="n:"+f);a.irisSeqId||(a.irisSeqId=d.toString(),g+="missing seq id");var h=b("Int64").fromString(a.irisSeqId.toString())||d;h.equals(d)?g+=" seqId match":(g+=" seqId mismatch",this.$5.bumpCounter("seq_id_running_id_mismatch"));var i={type:c,payload:a};this.$2.forEach(function(a){return a.onDeltaReceived(i)});e.status=g;return f};c.$17=function(){var a={sync_api_version:10,max_deltas_able_to_process:1e3,delta_batch_size:500,encoding:"JSON",entity_fbid:this.$1,initial_titan_sequence_id:this.$3&&this.$3.toString(),device_params:this.$6,queue_position:this.$7};return{topic:"/messenger_sync_create_queue",payload:JSON.stringify(a),qos:1}};c.$16=function(){var a={sync_token:this.$4,sync_api_version:10,max_deltas_able_to_process:1e3,delta_batch_size:500,encoding:"JSON",entity_fbid:this.$1,last_seq_id:this.$3&&this.$3.toString()};return{topic:"/messenger_sync_get_diffs",payload:JSON.stringify(a),qos:1}};return a}();var h=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MMessengerMQTTConnection",["CurrentUser","FBMqttChannel","MercurySingletonProvider","MMercurySyncDispatcher","MqttLogger","SyncProtocolClient","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a){this.$1=a,this.$2=b("MqttLogger").getInstance(),this.$3=!1}a.getForFBID=function(a){return g.getForFBID(a)};a.setUp=function(c){__p&&__p();var d=c.fbid,e=c.irisSeqID;c.appID;c.endpoint;if(!d||!e)return;c=b("MqttLogger").getInstance();if(!b("CurrentUser").isLoggedInNow()){c.debugTrace("run","User not logged in");c.bumpCounter("mtouch.user_not_loggged_in");return}else c.bumpCounter("mtouch.setup");c=a.getForFBID(d);c.initializeDeltaStream(d,e)};var c=a.prototype;c.initializeDeltaStream=function(a,c){if(this.$3)return;this.$2.bumpCounter("MMessageMQTTConnection.initializeDeltaStream");this.$3=!0;var d=null;b("gkx")("687751")&&(d={accept_pending_deltas:!0});b("SyncProtocolClient").getForFBID(a).init(b("FBMqttChannel"),c,d).addDeltaStreamListener(this)};c.onDeltaReceived=function(a){a.type;a=a.payload;b("MMercurySyncDispatcher").getForFBID(this.$1.toString()).process(a,"mqtt")};c.onStreamDisconnect=function(a){this.$2.bumpCounter("mtouch.stream_disconnect."+a)};return a}();var g=new(b("MercurySingletonProvider"))(a);e.exports=a}),null);
__d("MBackToNewsFeed",["JavelinHistory","MHistory","MHome","Stratcom"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=!1,h=[];function i(){if(!h||!h.length)return;h.forEach(function(a){a.remove()});h=[]}var j={init:function(){j.updateHistory()},updateHistory:function(a){__p&&__p();a===void 0&&(a=!1);if(a&&g)return;g=!0;if(!j._isBrowserSupported())return;if(b("MHistory").hasSoftState())return;if(history.state&&history.state.addedNewsFeed)return;a=location.href;var c=document.title;document.title="Facebook";window.history.replaceState({},"Facebook",b("MHome").HOME_PATH);window.history.pushState({addedNewsFeed:1},"Current",a);document.title=c},updateHistoryOnNav:function(a){__p&&__p();i();a=a.pattern;if(a.length){var c=new RegExp(a);h.push(b("Stratcom").listen("history:change",null,function(a){i();a=a.getData();if(!a||!a.path)return;a=a.path;c.test(a)&&j.updateHistory()}),b("Stratcom").listen("history:change-default",null,i),b("Stratcom").listen("m:homepage:load",null,i))}},_isBrowserSupported:function(){return b("JavelinHistory").CAN_USE_PUSH_STATE}};e.exports=j}),null);
__d("isElementPartiallyInViewport",["getElementRect","getViewportDimensions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){var c=b("getViewportDimensions")();if(!c.width||!c.height)return!1;a=b("getElementRect")(a);if(!a.width||!a.height)return!1;var d=a.top<=c.height&&a.top+a.height>=0;c=a.left<=c.width&&a.left+a.width>=0;return d&&c}e.exports=a}),null);
__d("MBackNavbar",["cx","fbt","CSS","DOM","Event","MAnimator","MArrays","MBackToNewsFeed","MHeaderLogger","MHistory","MHome","MJewelsTabability","MPageCache","MPageController","MPageFetcher","MStoriesUIConstants","MTitleListener","MURI","MViewport","Stratcom","UnicodeBidi","UnicodeBidiDirection","Vector","WebLite","getViewportDimensions","isElementPartiallyInViewport","onAfterTTI","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i=!1,j=!1,k=!1,l=[],m=!1,n=!1,o=!1,p=[],q=[],r=null,s=null,t=b("UnicodeBidiDirection").LTR,u=!1,v=!1,w=!0,x=null,y=!1,z=!1,A=!1,B=!1,C=!1,D=[],E=!1;function F(a){return a.split(",").map(function(a){a=a.toLowerCase();a.startsWith("/")||(a="/"+a);return a})}function G(){if(u||!m)return;b("MBackToNewsFeed").updateHistory(!0);!b("MHome").isHome()&&C&&b("onAfterTTI")(function(){!b("MHome").isHome()&&E&&b("MPageFetcher").prefetch(b("MHome").HOME_PATH)})}function H(a){try{a=new(b("MURI"))(a);a=a.getDomain()}catch(b){a=""}return a}function I(){var a=M();if(!a)return!1;a=H(a);return a.length>0&&!a.endsWith(".facebook.com")}function J(a,c,d){__p&&__p();d=b("MTitleListener").getTitleAsString(d);if(!d||typeof d.split!=="function")return;d=d.split("\n").join(" ");c.innerText=d;t=b("UnicodeBidi").getDirection(d,t);switch(t){case b("UnicodeBidiDirection").RTL:b("CSS").addClass(a,"rtl");break;default:b("CSS").removeClass(a,"rtl")}}function K(a,c,d,e){__p&&__p();var f=[];if(w){c.innerText="";f.push(b("Stratcom").listen("MDocument:title",null,function(b){var d=null;b&&(d=b.getData());J(a,c,d)}));var g=null;N()&&(g=h._("Facebook").toString());J(a,c,g)}g=function(){y=!0;if(!b("WebLite").isWebLite()&&b("WebLite").hasWebLiteMarker()&&history.length<=1){window.close();return}history.go(-1)};v?(d&&f.push(b("Event").listen(d,"click",g)),e&&f.push(b("Event").listen(e,"click",g))):f.push(b("Event").listen(a,"click",g));var i=!1;return function(){if(i)return;i=!0;f.forEach(function(a){a.remove()})}}var L=!0;function M(){if(L){L=!1;return document.referrer}return""}function N(){if(!D.length)return!1;if(!b("MHistory").hasSoftState)return!1;var a=b("MHistory").getState();return!a?!1:D.indexOf(a)!==-1}function O(a){return b("MHistory").hasSoftState()&&D.length?!1:b("MArrays").findPrefix(q,a)}function P(a){a=a||b("MHistory").getPath();var c="";if(a)try{a=new(b("MURI"))(a).normalize();c=a.getPath().toLowerCase()}catch(a){c=""}return c}function Q(a){__p&&__p();var b=I();if(n&&!b)return!1;b=P(a);if(O(b))return!1;if(o)return!0;if(!p.length)return!1;for(var a=0;a<p.length;a++)if(b.indexOf(p[a])!==-1)return!0;return!1}function R(){__p&&__p();s&&(s(),s=null);if(!r)return;var a=r;b("setTimeoutAcrossTransitions")(function(){__p&&__p();var c=b("MHistory").getPath(),d=b("MHome").isHome()&&!b("MHistory").hasSoftState(),e=null,f=null;v&&(e=document.getElementById("MBackNavBarLeftArrow"),f=document.getElementById("MBackNavBarRightArrow"));var g=d||b("MHistory").hasSoftState()&&!N()||v&&!e&&!f||!Q(c);if(g){b("CSS").removeClass(a,"show");if(j&&q.length&&l.length){g=P();O(g)&&b("MArrays").findPrefix(l,g)&&b("MHeaderLogger").logExposure(!0)}if(d&&A&&y){y=!1;g=document.getElementById("page");if(g){d=b("DOM").scry(g,"article","story-div");var h=null;for(var g=d.length-1;g>=0;g--)if(b("isElementPartiallyInViewport")(d[g]))break;else h=d[g];if(h){b("CSS").show(h);var i=b("getViewportDimensions")();b("setTimeoutAcrossTransitions")(function(){var a=b("MViewport").getScrollTop(),c=b("Vector").getPos(h).y-i.height+300,d=Math.abs(c-a),e=a;b("MAnimator").play(a,c,500,function(a){var c=b("MAnimator").easeInOutCubic((a-e)/d);c=Math.round((a-e)*c+e);e=a;b("MViewport").scrollToY(c)})},800)}}}b("Stratcom").invoke("m:backnav:show-jewels")}else{if(j){d=!1;if(k){g=P(c);(l.length===0||b("MArrays").findPrefix(l,g))&&(d=!0)}b("MHeaderLogger").logExposure(d)}if(!m)return;x&&(v?s=K(a,x,e,f):s=K(a,x));b("CSS").addClass(a,"show");z&&G();b("Stratcom").invoke("m:backnav:show-backbar")}},1)}function S(a){__p&&__p();if(i)return;i=!0;r=a.element;m=a.enabled;j=a.logExposure;k=a.qeExposure;n=a.enabledForExternalReferer;o=a.allPages;u=a.backToFeedDisabled;v=a.backOnArrowClick;x=a.linkElement;var c=a.forceRefreshFeed;A=c?!1:a.scrollToNextFeedItem;z=a.modifyHistoryOnNav;C=a.isPageLoggingAllowed;E=a.enableFeedPrefetch;!o?p=F(a.pages):a.excludedPages.length&&(q=F(a.excludedPages));var d=a.enableBackbarForSoftNav||"";d.length&&(D=d.split(","));a.exposurePages&&(l=F(a.exposurePages));q.length?q=q.concat(b("MStoriesUIConstants").HIDE_HEADER_URLS):q=b("MStoriesUIConstants").HIDE_HEADER_URLS;b("Stratcom").listen("history:change",null,R);b("Stratcom").listen("m:homepage:load",null,R);w=!a.staticTitle;m&&w&&(w=b("MTitleListener").init());w||b("CSS").addClass(x,"_6sow");if(!z){d=P();d=O(d);d||G()}d=a.element.getElementsByClassName("_84gg");for(var a=0;a<d.length;++a)b("MJewelsTabability").listen(d[a],!1,"0");R();c&&m&&(b("Stratcom").listen("m:page:beforeloading",null,function(a){__p&&__p();var c=y;y=!1;if(!a)return;a=a.getData();if(!a)return;var d=b("MPageController").getRenderedPath()||null;d=d&&b("MHome").isHome(d);if(d){B=!1;d=String(a).indexOf("?");if(d===-1)return;try{d=new(b("MURI"))(a);d=d.getQueryData()||{}}catch(a){d={}}d=d._bb_norefresh;d==="1"&&(B=!0)}else{d=b("MHome").isHome(a);var e=B;B=!1;c&&a&&d&&!e&&b("MPageCache").removeCachedPage(a)}}),b("Stratcom").listen("m:backnav:invalidate-cached-feed",null,function(){B=!1}))}e.exports={init:function(a){S(a)}}}),null);
__d("XBrowserPushXOutController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/notifications/client/push/xout/",{})}),null);
__d("XPushRegisterServiceWorkerController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/push/register/service_worker/",{})}),null);
__d("MNotificationsPushInstall",["Promise","BanzaiLogger","DOM","KaiOSController","MobileAppDetect","MPushPermissionUtil","MRequest","PushRegistration","Stratcom","URI","XBrowserPushXOutController","XPushRegisterServiceWorkerController"],(function(a,b,c,d,e,f){__p&&__p();var g;function h(a,c,d){a={event:a,appid:c,surface:d};b("BanzaiLogger").log("BrowserPushLoggerConfig",a)}function i(a){b("Stratcom").invoke(a),window.parent&&window.parent.postMessage(a,"*")}function j(a){if(!a)return!1;a=new(g||(g=b("URI")))(a).getDomain();return!a||a===window.location.hostname?!1:!0}a={installHandler:function(a,c){__p&&__p();h("turn_on",a.appID,c);var d;b("MobileAppDetect").is_kaios?d=a.registerPushOnKaiOS(b("XPushRegisterServiceWorkerController"),b("MRequest"),b("KaiOSController")):(b("MPushPermissionUtil").logEvent("turn_on_attempt"),b("PushRegistration").pushPermissionIsPending()&&b("Stratcom").invoke("m:notifications:push:install:showCurtain"),d=new(b("Promise"))(function(c,d){return a.registerPush(b("XPushRegisterServiceWorkerController"),b("MRequest"),function(){},!0,c)["catch"](d)}));return new(b("Promise"))(function(e,f){__p&&__p();d.then(function(){b("Stratcom").invoke("m:notifications:push:install:hideCurtain");b("MPushPermissionUtil").logEvent("allow");h("install",a.appID,c);e(!0);i("m:notifications:push:install:installed");return})["catch"](function(d){b("Stratcom").invoke("m:notifications:push:install:hideCurtain");window.Notification&&window.Notification.permission==="denied"?(b("MPushPermissionUtil").logEvent("deny"),h("deny",a.appID,c)):(b("MPushPermissionUtil").logEvent("install_ignore"),h("install_ignore",a.appID,c));i("m:notifications:push:install:notInstalled");f(d);return})})},xoutHandler:function(a,c){return new(b("Promise"))(function(d,e){h("xout",a.appID,c);var f=b("XBrowserPushXOutController").getURIBuilder().getURI();f=new(b("MRequest"))(f);f.setMethod("POST");f.listen("finally",d);f.listen("fail",e);f.send()})},registerOnHostIfNeeded:function(a){__p&&__p();return new(b("Promise"))(function(c,d){__p&&__p();if(!j(a)){c(!1);return}var e=b("DOM").create("iframe",{style:{height:"1px",width:"1px",display:"none"}});e.id="PushIframe";b("DOM").appendContent(window.document.body,e);e.src=a;var f=function(a){if(a.source!==e.contentWindow)return;a.data==="m:notifications:push:install:installed"&&c(!0);a.data==="m:notifications:push:install:notInstalled"&&d(!0)};window.removeEventListener("message",f,!1);window.addEventListener("message",f,!1)})}};e.exports=a}),null);
__d("MNotificationsPushInstallCurtain",["cx","CSS","DOM","MViewport","Stratcom"],(function(a,b,c,d,e,f,g){__p&&__p();var h="upsell_curtain",i="curtain_with_context",j=new Set(["ae","ar","arc","bcc","bqi","ckb","dv","fa","glk","he","ku","mzn","nqo","pnb","ps","sd","ug","ur","yi"]),k=null;function l(){if(k instanceof HTMLElement){var a=n(k);a&&b("CSS").show(k)}b("Stratcom").listen("click",h,m)}function m(){k instanceof HTMLElement&&b("CSS").hide(k)}a={startListening:function(a){k=a,b("Stratcom").listen("m:notifications:push:install:showCurtain",null,l),b("Stratcom").listen("m:notifications:push:install:hideCurtain",null,m)}};function n(a){__p&&__p();if(a.id!==i)return!0;var c=b("MViewport").getHeaderElement();if(b("MViewport").getHeight()*window.devicePixelRatio<400||b("MViewport").isLandscape()||!a||!c||!c.parentNode||!c.parentNode.parentNode||c.parentNode.parentNode.id!=="page")return!1;o(a);q(a);var d=b("DOM").create("div",{position:"relative"});d.appendChild(a);b("DOM").insertAfter(c.parentNode,d);return!0}function o(a){if(p()){a=a.getElementsByClassName("_1t9n")[0];a&&b("CSS").addClass(a,"_u6u")}}function p(){var a=b("DOM").create("div");a.setAttribute("style","position: fixed; bottom: 0; height: 100vh;");b("DOM").appendContent(document.body,a);var c=a.offsetHeight>window.innerHeight&&a.offsetTop<0;b("DOM").remove(a);return c}function q(a){var b=navigator.language||" ";if(j.has(b.substring(0,2))||j.has(b.substring(0,3))){b=a.getElementsByClassName("_1f0e")[0];b&&(b.className="_1f0f")}}e.exports=a}),null);
__d("MNotificationsPushUpsellFunnelLogger",["BanzaiLogger"],(function(a,b,c,d,e,f){a={log:function(a,c,d,e){a={attemptid:a,stage:c,appid:d,surface:e};b("BanzaiLogger").log("BrowserPushRegistrationFlowLoggerConfig",a)}};e.exports=a}),null);
__d("MToastAction",["cx","CSS","DOM","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h={showToast:function(a,c){var d=b("DOM").create("div",null,a);b("DOM").appendContent(document.body,d);b("setTimeoutAcrossTransitions")(function(){return b("CSS").addClass(d,"_4zke")},c);b("setTimeoutAcrossTransitions")(function(){return b("DOM").remove(d)},c+1e3)},showDefaultToast:function(a,c){a=b("DOM").create("div",{className:"_3fcy"},a);a=b("DOM").create("div",{className:"_2jow _3fc-"},a);h.showToast(a,c)}};e.exports=h}),null);
__d("QPEventHandling",[],(function(a,b,c,d,e,f){"use strict";a={registerClickListener:function(a,b,c){a.addEventListener("click",c)}};e.exports=a}),null);
__d("QPRenderer",["csx","CSS","FBLogger","Parent","QPEventHandling","XAsyncRequest","XQuickPromotionSimpleLoggingController","ge"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();function h(a,c,d){a=b("XQuickPromotionSimpleLoggingController").getURIBuilder().setInt("qp_id",a).setString("qp_event",c).setStringToStringMap("qp_instance_log_data",d).getURI();new(b("XAsyncRequest"))(a).send()}function a(a,c,d){a=b("XQuickPromotionSimpleLoggingController").getURIBuilder().setInt("qp_id",a).setEnum("qp_action",c).setStringToStringMap("qp_instance_log_data",d).getURI();new(b("XAsyncRequest"))(a).send()}function c(a,c,d,e,f,g){e=b("ge")(e);e!==null?i(a,d,e,g,function(){f&&b("CSS").hide(c)}):b("FBLogger")("quick_promotion").mustfix("Quick Promotion %s is missing %s action element.",a,d)}function d(a,c,d,e,f){i(a,c,d,f,function(){if(e){var a=b("Parent").bySelector(d,"._5jmm");a instanceof HTMLElement&&b("CSS").hide(a)}})}function e(a,c,d){c.show();h(a,"view",{});c.subscribe("cancel",function(){h(a,"dialog_cancel",{})});for(var e=0;e<d.length;e++){var f=d[e],g=b("ge")(f.element_id);g!==null?(i(a,f.action,g,f.extra_log_data,f.should_close?function(){c.hide()}:function(){}),f.action=="primary"&&g.focus()):b("FBLogger")("quick_promotion").mustfix("Quick Promotion %s is missing %s action element.",a,f.action)}}function i(a,c,d,e,f){b("QPEventHandling").registerClickListener(d,c,function(){var d=b("XQuickPromotionSimpleLoggingController").getURIBuilder().setInt("qp_id",a).setEnum("qp_action",c).setStringToStringMap("qp_instance_log_data",e).getURI();new(b("XAsyncRequest"))(d).send();f()})}f.setAction=c;f.setComponentActionForFeedUnitQP=d;f.setDialogActionsAndShow=e;f.logAction=a;f.logEvent=h}),null);
__d("MNotificationsPushUpsellInstaller",["fbt","MJewels","MNotificationsPushInstall","MNotificationsPushUpsellFunnelLogger","MToastAction","PushRegistration","QE2Logger","QPRenderer","Stratcom","isVisible"],(function(a,b,c,d,e,f,g){__p&&__p();var h=null,i=null,j=null,k=function(a){j&&j(a)},l=function(a,c,d,e,f,g){__p&&__p();if(b("PushRegistration").pushPermissionIsDenied())return!1;if(f){b("QE2Logger").logExposureForUser(f);if(g)return!1}j=function(a){b("MNotificationsPushUpsellFunnelLogger").log(d,a,c,e)};i=e;h=b("PushRegistration").get(a,c);return!0},m=function(){if(h===null||i===null)return;k("try_install");b("MNotificationsPushInstall").installHandler(h,i).then(function(){k("install_success"),b("MToastAction").showDefaultToast(g._("Facebook notifications on"),3e3)})["catch"](function(){h!==null&&i!==null&&(b("PushRegistration").pushPermissionIsDenied()?(k("system_dialog_deny"),b("MNotificationsPushInstall").xoutHandler(h,i)):k("system_dialog_ignore"))})},n=function(a){k("impression"),b("QPRenderer").logEvent(a,"view",{}),k(b("PushRegistration").pushPermissionIsDenied()?"permissions_blocked":"permissions_unblocked")},o="m:qp:push-notifications:log-impression",p={invokeImpressionEvent:function(){b("Stratcom").invoke(o)},installOnUpsellClick:function(a,c,d,e,f,g,h,i,j,q){__p&&__p();if(!l(a,c,f,g,j,q))return!1;b("isVisible")(i)?n(h):(b("Stratcom").listen(o,null,function(){b("Stratcom").removeCurrentListener(),n(h)}),b("Stratcom").listen("m:jewel:flyout:open",null,function(a){a.getData().jewel===b("MJewels").NOTIFICATIONS&&(b("Stratcom").removeCurrentListener(),p.invokeImpressionEvent())}));b("Stratcom").listen("click",d,function(){k("action_turn_on"),b("PushRegistration").pushPermissionIsDenied()?k("error_permissions_blocked"):m()});b("Stratcom").listen("click",e,function(){k("action_not_now")});return!0},installDirectFromUpsell:function(a,c,d,e,f,g,h){l(a,c,e,f,g,h)&&(p.invokeImpressionEvent(),b("QPRenderer").logEvent(d,"view",{}),m())},install:function(a){if(b("PushRegistration").pushPermissionIsDenied())return;a.isInControlGroup||(a.promotionContainerNode.style.display="block");p.installOnUpsellClick(a.path,a.appID,a.installButtonSigil,a.notNowButtonSigil,a.installAttemptID,a.surface,a.promotionID,a.promotionContainerNode,a.qeUniverseName,a.isInControlGroup)}};e.exports=p}),null);
__d("MNotificationsDirectPrompt",["Promise","MNotificationsPushInstall","MNotificationsPushInstallCurtain","MNotificationsPushUpsellInstaller","MobileAppDetect","MPushPermissionUtil","MRequest","PushRegistration","XBrowserPushDisabledController","XPushRegisterServiceWorkerController","gkx","goURI","promiseDone"],(function(a,b,c,d,e,f){__p&&__p();a={installPush:function(a){__p&&__p();a.curtain&&b("MNotificationsPushInstallCurtain").startListening(a.curtain);var c=b("PushRegistration").get(a.path,a.appID);if(b("MobileAppDetect").is_kaios){var d=b("gkx")("854369");(d||!a.isInstalled)&&!a.wasXOuted&&b("MNotificationsPushInstall").installHandler(c,"prompt");return}a.wasXOuted&&a.upsell?b("MNotificationsPushUpsellInstaller").installDirectFromUpsell(a.path,a.appID,a.upsell.promotionID,a.upsell.installAttemptID,a.upsell.surface,a.upsell.qeUniverseName,a.upsell.isInControlGroup):b("MPushPermissionUtil").logEvent("fresh_nonupsell_promo");var e=b("Promise").resolve(),f=function(){a.redirectUrl&&window.location!==a.redirectUrl&&(a.isNuxPrompt===!0?b("goURI")(a.redirectUrl,!1,!0):b("goURI")(a.redirectUrl+"?_rdr",!1,!0))};b("promiseDone")(b("MNotificationsPushInstall").registerOnHostIfNeeded(a.enabledUrl).then(function(d){if(d){b("MPushPermissionUtil").logEvent("already_registered");return}c.isPushRegistered(a.isInstalled,b("XPushRegisterServiceWorkerController"),b("XBrowserPushDisabledController"),b("MRequest"),a.registerAnyway,function(){},!0).then(function(d){a.wasXOuted?b("MPushPermissionUtil").logEvent("previously_xouted"):a.isInstalled&&d&&b("MPushPermissionUtil").logEvent("already_installed"),(!a.isInstalled||!d)&&!a.wasXOuted?b("MNotificationsPushInstall").installHandler(c,"prompt")["catch"](function(){e=b("MNotificationsPushInstall").xoutHandler(c,"prompt")})["finally"](function(){return e.then(f)}):f()},function(a){b("MPushPermissionUtil").logEvent("push_regn_failure")})},function(a){b("MPushPermissionUtil").logEvent("recently_rejected")}))}};e.exports=a}),null);
__d("MFirstPageRecorder",["Arbiter","DOM","MDeepCopy","MPageCache","MPageController","MPageHeaderRight","MPageTitle","MRequestConfig","MResponseData","MURI","ScriptPath","ServerJS","Stratcom","$","ge"],(function(a,b,c,d,e,f){__p&&__p();var g,h=!1,i=!1,j=[],k=new(b("MURI"))(b("MPageController").getRenderedPath()),l,m=[],n=[];({});var o=["m:chrome:schedulable-graph-search","first_response","last_response","MNotificationFlyoutContent","MMessegesFlyoutContent","MFriendRequestsFlyoutContent"];function p(){if(!l)return;b("MPageCache").setCachedPage(k,l);b("MPageCache").clearCachedIUIResponses(k);m.forEach(function(a){b("MPageCache").addCachedIUIResponse(k,a)});i=!0}function q(){__p&&__p();if(h)return;h=!0;var a={ajax_response_token:b("MRequestConfig").ajaxResponseToken.secret,js:[],css:[],ixData:null,bxData:null,actions:[]},c=b("$")("root").cloneNode(!0),d=[];l=new(b("MResponseData"))({ajax_response_token:b("MRequestConfig").ajaxResponseToken.secret,js:[],css:[],ixData:{},bxData:{},actions:[{cmd:"script",type:"immediate",fn:function(){b("DOM").replace(b("$")("root"),c.cloneNode(!0))}}]});var e=b("MPageHeaderRight").getChromeHeaderRightContent();e&&e.length>0&&d.push(function(){var a=document.createDocumentFragment();for(var c=0;c<e.length;c++)a.appendChild(e[0]);b("MPageHeaderRight").setup({node:a})});var f=document.title;d.push(function(){b("MPageTitle").setTitle(f)});var g=b("ScriptPath").getPageInfo();g&&d.push(function(){b("ScriptPath").set(g.scriptPath,g.categoryToken,g.extraData)});a.actions=d.map(function(a){return{cmd:"script",type:"onload",fn:a}});m.push(new(b("MResponseData"))(a))}function r(a,c,d){var e={ajax_response_token:b("MRequestConfig").ajaxResponseToken.secret,js:[],css:[],ixData:null,bxData:null,actions:[]};e.actions=Object.keys(a).map(function(b){return{cmd:"replace",target:b,html:a[b],replaceifexists:!1,allownull:!1}});c&&e.actions.push({cmd:"append",target:"static_templates",html:c,replaceifexists:!0});d&&e.actions.push({cmd:"script",type:"onload",fn:function(){new(b("ServerJS"))().handle(b("MDeepCopy")(d))}});q();m.push(new(b("MResponseData"))(e))}function s(a,c){if(!a||o.includes(a.id))return;i?(r(a.contentMap,a.staticTemplates,a.jsmods),b("MPageCache").addCachedIUIResponse(k,m.pop())):n.push(a)}function t(){l=null,h=!0}function u(){for(var a=0,b=n.length;a<b;a++)r(n[a].contentMap,n[a].staticTemplates,n[a].jsmods);p();n=[];m=[]}function a(a){__p&&__p();if(g)return;g=!0;a;b("MPageCache").setPageCacheComplete(k,!0);var c=b("Arbiter").subscribe(["pagelet_performing_replayable_actions","pagelet_performing_replayable_actions_failed","all_pagelets_loaded"],function(b,c){switch(b){case"pagelet_performing_replayable_actions":s(c,a);break;case"pagelet_performing_replayable_actions_failed":t();break;case"all_pagelets_loaded":u();break}}),d=b("Arbiter").subscribe(["MRenderingScheduler/pageletSchedule","MRenderingScheduler/dd"],function(a,c){switch(a){case"MRenderingScheduler/pageletSchedule":if(c.pageletConfig.type==="content"){a=(a={},a[c.id]=c.element?b("ge")(c.element).innerHTML:c.content.__html,a);r(a,c.pageletConfig.templates.__html,b("MDeepCopy")(c.pageletConfig.serverJSData))}break;case"MRenderingScheduler/dd":p();break}});j=[c,d]}b("Stratcom").listen("m:page:unload",null,function(){j.forEach(function(a){a&&a.unsubscribe()}),j=[],g=!0,l=null,m=[],n=[],b("Stratcom").removeCurrentListener()});f.startPageletCaching=a}),null);